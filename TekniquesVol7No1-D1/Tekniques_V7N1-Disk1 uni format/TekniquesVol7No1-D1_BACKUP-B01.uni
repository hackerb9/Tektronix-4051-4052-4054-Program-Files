100 REM --------------- File $BACKUP.B01 ---------------110 REM ##### Create and open the alphabet file #####120 KILL "$BACKUP.DAT"130 CREATE "$BACKUP.DAT";256,0140 WBYTE @95,63,32:99,D,2,0,0,0,0,0,0,0,0,0150 WBYTE 83,89,83,76,73,66,47160 WBYTE 66,65,67,75,85,80,46,68,65,84,-36170 WBYTE @64:180 RBYTE N190 IF N=>0 THEN 180200 WBYTE @95,63:210 REM ##### Write the alphabet to the file #####220 WBYTE @32:130,2,0,0,0,-256,7,0,1,0230 FOR I=0 TO 255240 WBYTE I250 NEXT I260 WBYTE @95,63:270 REM ##### Close the alphabet file #####280 WBYTE @32:100,2,255,255,255,255,-256290 WBYTE @95,63:300 REM ##### Read the alphabet back into a string #####310 OPEN "$BACKUP.DAT";2,"R",Z$320 READ #2:T$330 CLOSE 2340 REM ##### Append in the file manipulation routines #####350 N=MEMORY360 APPEND "@SYSLIB/BACKUP.B03";10000,0370 REM ##### Prepare the disk for use #####380 PRINT "


"390 PRINT "   Insert the disk you would like to backup in device ";D400 PRINT "     and press RETURN: ";410 INPUT Z$420 CALL "MOUNT",D,Z$430 REM ##### User interrogation: which file? #####440 PRINT "

   Which file do you wish to archive (RETURN to quit)? ";450 INPUT F$460 IF NOT(LEN(F$)) THEN 1900470 REM ##### Is there really such a file? #####480 IF ASC(F$)=64 THEN 500490 F$="@SCRATCHLIB/"&F$500 CALL "FILE",D,F$,Z$510 IF LEN(Z$) THEN 550520 PRINT "        ***No such file.***"530 GO TO 440540 REM ##### The file exists: is there anything in it? #####550 A$=SEG(Z$,86,6)560 U=VAL(A$)570 IF U THEN 610580 PRINT "        ***The requested file is empty.***"590 GO TO 440600 REM ##### Not empty: ask for a backup tape #####610 PRINT "   Insert the appropriate tape and press RETURN: ";620 INPUT A$630 FIND 1640 INPUT @33:A$650 REM ##### Create the directory storage file #####660 CLOSE 1670 KILL "$BACKUP.DIR"680 CREATE "$BACKUP.DIR";5000,0690 OPEN "$BACKUP.DIR";1,"F",A$700 REM ##### Prepare for the tape directory search #####710 C$=F$&"$"720 C$=REP("",1,1)730 E=0740 F=1750 F1=999760 REM ##### Top of the tape directory search loop #####770 F=F+1780 INPUT @33:A$790 IF E THEN 1060800 IF POS(A$,C$,1)=1 THEN 850810 REM ##### This item is not the correct file: save it #####820 WRITE #1:A$830 GO TO 770840 REM ##### This is the right item: kill the scratch entry #####850 WRITE #1:""860 F1=F870 REM ##### Save off the file size #####880 N=POS(A$,"%",1)890 C$=SEG(A$,N+1,6)900 N=VAL(C$)910 REM ##### Finish saving the tape directory to scratch #####920 F=F+1930 INPUT @33:A$940 IF E THEN 980950 WRITE #1:A$960 GO TO 920970 REM ##### How much space is needed for the disk file? #####980 C$=SEG(Z$,86,6)990 U=VAL(C$)1000 U=U+4*INT(U/252)1010 B$=F$1020 IF U<=N+256 THEN 18401030 PRINT "        ***The file on tape is marked too small.***"1040 GO TO 10701050 REM ##### Tape directory search failed: still want to save? #####1060 PRINT "        ***The file is not archived on this tape.***"1070 PRINT "   Do you want to add the file to this tape (Y/N_)? ";1080 INPUT A$1090 IF A$<>"Y" THEN 15301100 REM ##### A save on this tape is desired: get file parameters #####1110 B$=SEG(Z$,189,LEN(Z$)-189)1120 C$=SEG(Z$,1,13)1130 C$=REP("",1,5)1140 C$=REP("",2,1)1150 C$=REP("",3,1)1160 C$=REP("",4,2)1170 N=VAL(Z$)1180 D$=STR(N)1190 D$=REP("",1,1)1200 Z$=REP("",1,61)1210 U=VAL(Z$)1220 E$=STR(U)1230 E$=REP("",1,1)1240 Z$=REP("",1,79)1250 N=VAL(Z$)1260 Z$=STR(N)1270 Z$=REP("",1,1)1280 A$=B$&"$"1290 A$=A$&C$1300 A$=A$&"#"1310 A$=A$&D$1320 A$=A$&"%"1330 A$=A$&E$1340 A$=A$&"&"1350 A$=A$&Z$1360 REM ##### Save file parameters on scratch disk file #####1370 WRITE #1:A$1380 CALL "REWIND",11390 REM ##### Write the new directory on the tape #####1400 FIND 11410 PRINT @33:"***Disk Backup Tape***"1420 E=01430 READ #1:Z$1440 IF E THEN 14801450 PRINT @33:Z$1460 GO TO 14301470 REM ##### Locate the new tape file and allocate room #####1480 FIND F1490 MARK 1,U+2671500 F1=9991510 GO TO 18301520 REM ##### Save on current not desired: another tape? #####1530 PRI "   Do you want to add the file to another tape (Y/N_)? ";1540 INPUT A$1550 IF A$<>"Y" THEN 4401560 REM ##### Save on another tape: delete from current directory #####1570 CALL "REWIND",11580 FIND 11590 E=01600 PRINT @33:"***Disk Backup Tape***"1610 READ #1:A$1620 IF E THEN 16501630 PRINT @33:A$1640 GO TO 16101650 FIND 11660 PRINT "        ***File deleted from this tape.***"1670 REM ##### Get another tape #####1680 PRINT "   Insert the appropriate tape and press RETURN: ";1690 INPUT A$1700 FIND 11710 REM ##### Is it really a backup tape? #####1720 INPUT @33:A$1730 IF A$="***Disk Backup Tape***" THEN 6601740 PRINT "        ***This is not a backup tape.***"1750 PRINT "   Okay to destroy the information on this tape (Y/N_)? ";1760 INPUT A$1770 IF A$<>"Y" THEN 16801780 REM ##### It wasn't a backup tape, but permission to kill #####1790 FIND 01800 MARK 1,100001810 GO TO 13801820 REM ##### Final preparations for file copy #####1830 B$="@"&B$1840 E=01850 FIND F MIN F11860 GOSUB 100001870 FIND 01880 GO TO 4401890 REM ##### That's all, folks! #####1900 PRINT "

   Disk backup completed."1910 CLOSE 1920 END 10000 REM ##### Target line for append #####