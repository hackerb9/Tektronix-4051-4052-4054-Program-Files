9980 REM --------------- File $BACKUP.R03 ---------------9990 REM ##### File copy subroutine: interpret the directory item #####10000 GOSUB 1100010010 A$="@"&A$10020 REM ##### Make sure the file doesn't already exist #####10030 KILL A$10040 IF POS(B$,"H",1) THEN 1009010050 REM ##### Data file: allocate space and name #####10060 CREATE A$,B$;A+0,S+010070 GO TO 1010010080 REM ##### Program file: save dummy to the same name #####10090 SAVE A$;998010100 PRINT "     RESTORE -- ";A$10110 A$=REP("",1,1)10120 REM ##### Open the file #####10130 GOSUB 1200010140 REM ##### Locate the tape file #####10150 FIND F10160 WBYTE @32:130,2,0,0,0,-25610170 REM ##### Write to the disk file byte by byte #####10180 GO TO TYP(0) OF 10200,10200,10340,1026010190 REM ##### Erroneous data type on the tape: abort the copy #####10200 PRINT "     ***Tape error on file ";F;" -- invalid format.***"10210 WBYTE @95,63,32:100,2,255,255,255,255,-25610220 REM ##### Close the file #####10230 WBYTE @95,63:10240 RETURN 10250 REM ##### String type: send it byte by byte #####10260 READ @33:A$10270 FOR I=1 TO LEN(A$)10280 N=ASC(A$)10290 WBYTE N10300 A$=REP("",1,1)10310 NEXT I10320 GO TO 1018010330 REM ##### Numeric type: send as byte and terminate copy #####10340 READ @33:N10350 WBYTE N10360 GO TO 1021010990 REM ##### Directory item interpreting subroutine #####11000 N=POS(Z$,"$",1)11010 REM ##### Filename in A$ #####11020 A$=SEG(Z$,1,N-1)11030 Z$=REP("",1,N)11040 N=POS(Z$,"#",1)11050 REM ##### Attributes in B$ #####11060 B$=SEG(Z$,1,N-1)11070 Z$=REP("",1,N)11080 REM ##### Allocated size in A #####11090 A=VAL(Z$)11100 N=POS(Z$,"&",1)11110 Z$=REP("",1,N)11120 REM ##### Record size in S #####11130 S=VAL(Z$)11140 IF NOT(S) THEN 1117011150 REM ##### For random file, A is the number of records #####11160 A=INT((A+S-1)/S)11170 RETURN 11990 REM ##### File open subroutine #####12000 WBYTE @95,63,32:99,D,2,0,0,0,0,0,0,0,0,012010 FOR I=1 TO LEN(A$)12020 N=ASC(A$)12030 WBYTE N12040 A$=REP("",1,1)12050 NEXT I12060 WBYTE -3612070 WBYTE @95,63:12080 WBYTE @64:12090 RBYTE N12100 IF N=>0 THEN 1209012110 RBYTE N12120 WBYTE @95,63:12130 RETURN 