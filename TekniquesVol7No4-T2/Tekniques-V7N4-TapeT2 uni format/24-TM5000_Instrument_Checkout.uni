2 GO TO 1003 REM *** USER KEY handler - line numbers = key numbers multiplied by 44 REM  KEY 1 - MENU5 F0=16 GO TO 3008 REM  KEY 2 - INITIALIZE9 F0=210 GO TO 30012 REM  KEY 3 - INSTRUMENT LIST13 F0=314 GO TO 30016 REM  KEY 4 - CONTINUE ON FAULT17 F0=418 GO TO 30020 REM  KEY 5 - LOOP ON TEST21 F0=522 GO TO 30024 REM  KEY 6 - PS501025 F=226 GO TO 40028 REM  KEY 7 - DM501029 F=330 GO TO 40032 REM  KEY 8 - FG501033 F=434 GO TO 40036 REM  KEY 9 - DC500937 F=538 GO TO 40040 REM  KEY 10 - DC501041 F=642 GO TO 40044 REM  KEY 11 - PRINT TEST INFORMATION45 F0=646 GO TO 30048 REM  KEY 12 - RETURN TO BASIC (DONE)49 F0=750 GO TO 30052 REM  KEY 13 - READ/WRITE IMMEDIATE53 F0=854 GO TO 30056 REM  Key 14 - Test Mode57 F0=958 GO TO 30060 REM  KEY 15 - DATA LOGGING61 F0=1162 GO TO 30064 REM  KEY 16 - RUN ALL TESTS65 F0=1066 GO TO 30076 REM  KEY 19 - SI501077 F=778 GO TO 40080 REM  KEY 20 - MI501081 F=882 GO TO 400100 REM105 REM             **** LOOP ON ASTERISK - Wait for USER-KEY input ****110 REM115 REM *** First time - GOSUB 900 & 2300 to initialize program ***120 F0=0125 GOSUB 900130 GOSUB 2300135 REM ** Get rid of lines 125 & 130 to prevent re-initializing **140 DELETE 125,130145 GOSUB 180150 REM ** Blinking asterisk **155 PRINT @32,24:"*"160 FOR I=1 TO 25165 NEXT I170 GO TO 150175 REM ** Prepare for next USER-KEY input **180 ON SRQ THEN 2900185 SET KEY 190 PRINT 195 PRINT "Press USER KEY:";200 RETURN 205 REM ** The above RETURN statement terminates implied GOSUB initiated210 REM    by the USER-KEYS and will always return you to a point215 REM    in the 'BLINKING ASTERISK' routine, above.                 **300 REM305 REM                         ****   RUN PROGRAM CONTROL ROUTINE  ****310 REM315 PRINT 320 SET NOKEY 325 GOSUB F0 OF 2400,900,1100,1900,2000,2100,1800,700,850,2800,3300330 GO TO 180335 REM ** Go back to wait loop **400 REM405 REM                                 ***  OVERLAY TEST PROGRAM   ****410 REM415 SET NOKEY 420 X$=SEG(T$,10*(F-2)+4,7)425 IF T(N3)+1=F THEN 447430 PRINT 435 PRINT "The ";X$;" is not selected for test in the Instrument List";445 GO TO 180447 IF POS(F$,X$,1)>0 THEN 470450 DELETE 4001,9999455 FIND F+M0460 X9=MEMORY465 APPEND 4000470 PAGE 475 N4=N3480 GOSUB 4000485 GO TO 180490 REM ** Go back to wait loop **500 REM505 REM                                           ***  WRITE TO GPIB ***510 REM515 IF F1=0 THEN 525520 PRINT @D0:"Put    ";A$525 PRINT @P(N4):A$530 RETURN 600 REM605 REM                                         **** READ FROM GPIB  ***610 REM615 INPUT @P(N4):B$620 IF F1=0 THEN 630625 PRINT @D0:"Got    ";B$630 RETURN 700 REM705 REM                                     *** READ/WRITE IMMEDIATE ***710 REM715 PAGE 720 PRINT "This routine will allow you to enter Instrument Commands"725 PRINT "directly from the 4050 keyboard."730 PRINT 735 PRINT "The instrument to which the commands are directed is"740 PRINT "selected in the INSTRUMENT LIST."745 PRINT 750 PRINT "You will be prompted for input with ""??"""755 PRINT 760 PRINT "To get out of the READ/WRITE IMMEDIATE loop, type ""EXIT""."762 PRINT 763 PRINT "To re-send the last command line you entered, hit RETURN"765 PRINT "(with no text) in response to the ""??"" prompt"767 N4=N3770 X=F1775 F1=1780 PRINT 785 PRINT "??";790 INPUT C$792 IF C$="EXIT" THEN 840795 IF C$="" THEN 800797 A$=C$800 GOSUB 500805 IF POS(A$,"?",1)=0 AND POS(A$,"SEND",1)=0 THEN 835830 GOSUB 600835 GO TO 780840 F1=X845 RETURN 850 REM855 REM                                                *** TEST MODE ***860 REM865 PAGE 870 PRINT "You have the option of testing the instruments for proper"875 PRINT "recognition of ""legal"" commmands (the normal mode of this"880 PRINT "checkout software), or you may test for proper error code"885 PRINT "generation."890 PRINT 895 PRINT "Enter ""0"" for normal mode or ""7"" for Error Code tests: ";896 INPUT M0897 F$=" "898 RETURN 900 REM905 REM                                            **** INITIALIZE  ****910 REM915 DELETE Q$,A$,O$,R$,S,P,T,T$,Y$,I$,W$920 DIM Y$(1),A$(215),O$(215),R$(215),B$(215),S(8),P(15),T(15),I$(215)922 DIM W$(215)925 F1=0930 REM ^^ F1 set to 0 = No printout of test information  ^^^935 R=0940 REM ^^ R set to 0 = Stop on error (1 = Continue) ^^^945 L=1950 REM  ^^^ L set to 1 = Loop on test 1 time ^^^952 M0=0953 REM ^^^ M0 set to 0 = Run Legal Mode tests ^^^955 P=0960 REM ^^^ Array P set to all-zero's - defines entire array. ^^^965 P(1)=22970 REM ^^ P(1) set to 22 = Primary Address assumed. ^^975 T=0980 REM ^^ Array T set to all-zero's - defines entire array. ^^985 T(1)=1990 REM ^^ T(1) set to 1 = Instrument Type PS510P assumed. ^^995 N1=11000 REM ^^ N1 set to 1 = Number of instruments on list - one assumed.1005 N2=01010 REM ^^ N2 set to 0 = Temp. var. used in Instrument list ^^1015 N3=11020 REM ^^ N3 set to 1 = Instrument selected for individual tests ^^1025 N4=11030 REM ^^ N4 set to 1 = Instrument to be addressed by READ & WRITE ^^1035 T$="1..PS5010 2..DM5010 3..FG5010 4..DC5009 5..DC5010 "1037 T$=T$&"6..SI5010 7..MI5010 "1040 REM ^^ T$ contains list of device TYPES ^^1042 F$="No file appended yet"1043 REM ^^ F$ will contain the name of the running test file1045 S=01050 REM ^^ S is status array (X8) set in SERIAL POLL routine  ^^^1055 R$="INIT"1060 REM ^^ R$ is used to set instruments to POWER UP state ^^1062 D0=321063 REM ^^ D0 is data logging address, set here to 'Terminal Screen'1065 ON SRQ THEN 29001070 PRINT @32,26:01075 IF F0=0 THEN 10851080 PRINT "Initialized to START-UP parameters."1085 RETURN 1100 REM1105 REM                                         *** INSTRUMENT LIST ***1110 REM1115 PAGE 1120 PRINT "Changes are made to the Instrument List by entering the"1125 PRINT "INSTRUMENT TYPE (T) and PRIMARY ADDRESS (P) as follows:"1130 PRINT 1135 PRINT "To add an instrument, type:      T@P"1140 PRINT "To delete an instrument, type:   D@P"1145 PRINT "To select an instrument, type:   S@P"1150 PRINT 1155 PRINT "To make multiple changes with one entry, place a"1160 PRINT "semi-colon (;) between commands."1165 PRINT 1170 PRINT "The current Instrument List is:"1175 PRINT 1180 IF SUM(T)=0 THEN 16151185 FOR I=1 TO N11190 X$=SEG(T$,10*(T(I)-1)+4,7)1195 PRINT USING "5X,7A,1A,1X,2D":X$,"@",P(I)1200 NEXT I1205 PRINT 1210 IF N3<1 THEN 15951215 X$=SEG(T$,10*(T(N3)-1)+4,7)1220 PRI "The currently selected instrument is the ";X$;"@ Add. ";P(N3)1225 PRINT 1230 PRINT "Do you want to change the list ?";1235 INPUT Y$1240 GO TO POS("YN",Y$,1)+1 OF 1225,1245,15851245 PRINT 1250 PRINT "Instrument types available:"1255 PRINT 1260 FOR I=1 TO 61 STEP 101265 X$=SEG(T$,I,10)1270 PRINT "     ";X$1275 NEXT I1280 PRINT 1285 PRINT "Enter changes: ";1290 INPUT Q$1295 GOSUB 16251300 FOR K=1 TO C11305 IF C1<>1 THEN 13151310 P1=LEN(Q$)+11315 N2=POS(Q$,"@",P1(K)-3)1320 IF N2<P1(K)-3 OR N2>P1(K)-1 THEN 15701325 X$=SEG(Q$,N2+1,P1(K)-N2)1330 P2=VAL(X$)1335 IF P2<0 OR P2>31 THEN 15701340 X$=SEG(Q$,N2-1,1)1345 IF X$="D" THEN 14201350 IF X$="S" THEN 15301355 T(N1+1)=VAL(X$)1360 IF T(N1+1)<1 OR T(N1+1)>7 THEN 15701365 IF N1>0 THEN 13851370 P(N1+1)=P21375 N1=N1+11380 GO TO 14101385 FOR I=1 TO N11390 IF P2=P(I) THEN 14051395 NEXT I1400 GO TO 13701405 T(I)=T(I+1)1410 NEXT K1415 GO TO 11001420 REM *** This is the DELETE routine ***1425 IF N1>1 THEN 14451430 N1=01435 N3=01440 GO TO 15701445 FOR I=1 TO N11450 IF P2=P(I) THEN 14651455 NEXT I1460 GO TO 15701465 IF N3<>I THEN 14751470 N3=01475 IF N1>I THEN 14901480 N1=N1-11485 GO TO 14101490 IF N3<=I THEN 15001495 N3=N3-11500 N1=N1-11505 FOR J=I TO N11510 T(J)=T(J+1)1515 P(J)=P(J+1)1520 NEXT J1525 GO TO 14101530 REM *** This is the SELECT routine ***1535 IF N1=0 THEN 15851540 FOR I=1 TO N11545 IF P(I)=P2 THEN 15601550 NEXT I1555 GO TO 15701560 N3=I1565 GO TO 14101570 PRINT "I don't understand you"1575 PRINT 1580 GO TO 16201585 IF N1=0 THEN 16151590 IF N3<>0 THEN 16101595 PRINT "No instrument is selected for testing"1600 PRINT 1605 GO TO 16201610 RETURN 1615 PRINT "There are no instruments on your list"1620 GO TO 12451625 REM *** Routine to parse Q$ ***1630 C1=01635 C2=01640 FOR I=1 TO LEN(Q$)1645 X$=SEG(Q$,I,1)1650 IF X$=";" THEN 17001655 NEXT I1660 IF C2=1 THEN 16701665 GO TO 16751670 RETURN 1675 C2=11680 DELETE P11685 DIM P1(C1+1)1690 C1=11695 GO TO 16401700 IF C2=1 THEN 17151705 C1=C1+11710 GO TO 16551715 P1(C1)=I1720 P1(C1+1)=LEN(Q$)+11725 C1=C1+11730 GO TO 16551800 REM1805 REM                                ***** RETURN TO 4050 BASIC  ****1810 REM1815 REM ** Send Device CLear **1820 WBYTE @20:1825 REM ** Send UNListen **1830 WBYTE @63:1835 REM ** Send UNTalk  **1840 WBYTE @95:1845 REM ** Set all settings to POWER UP condition  **1850 A$=R$1855 FOR N4=1 TO N11860 IF P(N4)=0 THEN 18701865 GOSUB 5001870 NEXT N41875 PRINT @32,26:01880 REM ^^^^ Sets Screen Full flag to blinking "F"  ^^^^1885 SET NOKEY 1890 PRINT "Return to 4050 series BASIC."1895 END 1900 REM1905 REM                                        ***CONTINUE ON ERROR ***1910 REM1915 IF R=1 THEN 19351920 PRINT "Testing will now - CONTINUE when an error is detected."1925 R=11930 RETURN 1935 PRINT "Testing will now - HALT when an error is detected."1940 R=01945 RETURN 2000 REM2005 REM                                           *** LOOP ON TEST  ***2010 REM2015 PRINT 2020 PRINT "Enter the number of times to loop ";2025 PRINT "on all tests.";2030 INPUT L2035 RETURN 2100 REM2105 REM                                      ****  SET PRINT FLAG  ****2110 REM2115 PAGE 2120 PRINT "Information about what data is sent, what data is received,"2125 PRINT "and other pertinent information about the test can be "2130 PRINT "printed on the terminal screen."2135 PRINT 2140 PRINT 2145 PRINT "Do you want the test information printed?";2150 INPUT Y$2155 GO TO POS("YN",Y$,1)+1 OF 2140,2165,21852160 REM ^^^ Test for legal entry and branch accordingly.2165 F1=12170 PRINT 2175 PRINT "Because of the numerous print outs when the flag is set,"2180 GO TO 22052185 F1=02190 PRINT 2195 PRINT "When running multiple loops of a test or ALL, the screen"2200 PRINT "may become filled with the various test overlay titles and"2205 PRINT "you may want to have the screen paged automatically and/or"2210 PRINT "copies made automatically.  If so enter:"2215 PRINT 2220 PRINT "      0 -- No PAGE, no COPY (blinking F)"2225 PRINT "      2 -- PAGE, no COPY"2230 PRINT "      3 -- PAGE and COPY  ";2235 INPUT N2240 PRINT @32,26:N2245 RETURN 2300 REM2305 REM                     *** PRINT TITLE AND COPYRIGHT NOTICE  *****2310 REM2315 PAGE 2320 GOSUB 23702325 PRINT "                 4050/TM5000 Evaluation Software"2330 PRINT 2335 PRINT "                    Version 99-94   26 OCT 82"2340 PRINT 2345 PRINT "                 Copyright 1980   Tektronix, Inc."2350 PRINT 2355 PRINT "                       ALL RIGHTS RESERVED"2360 GOSUB 23702365 GO TO 24202370 FOR I=0 TO 702375 PRINT "-";2380 NEXT I2385 PRINT 2390 RETURN 2400 REM2405 REM                                            ***  PRINT MENU  ***2410 REM2415 PAGE 2420 RESTORE 24502425 FOR I=1 TO 142430 READ M$,N$,O$2435 PRINT M$,"       ";N$,"        ";O$2440 NEXT I2445 RETURN 2450 DATA " "," "," "," "," "," "," "," "," "2455 DATA "                    Menu -- User Definable Keys:"," "," "2460 DATA " "," "," "," "," "," "2465 DATA "1..Menu","6...PS5010","11..Print Test Info."2470 DATA "2..ReInitialize","7...DM5010","12..Return to 4050 BASIC"2475 DATA "3..Instrument List","8...FG5010","13..Read/Write Immediate"2480 DATA "4..Cont. on Fault","9...DC5009","14..Select Test Mode"2485 DATA "5..Loop on Test","10..DC5010","15..Select Logging Device"2490 DATA " ","19..SI5010","16..Run ALL Tests"2495 DATA " ","20..MI5010"," "," "," "," "2500 REM2505 REM                                          ***  ERROR HANDLER ***2510 REM2515 REM E$=Error message2520 REM F$=Test in process2525 IF R<>1 THEN 25452530 PRINT @D0:"  ****  ERROR  **** "2535 GOSUB 25702540 RETURN 2545 GOSUB 23702550 PRINT @D0:"Stop on ERROR .... ";2555 GOSUB 25702560 GOSUB 23702565 END 2570 PRINT @D0:E$;" During ";F$2575 PRINT @D0:"          Sent: ";A$2580 PRINT @D0:"      Received: ";B$2585 PRINT @D0:"      Expected: ";I$2630 RETURN 2635 REM ^^^ Sub-routine 2370 draws lines (------)  ^^^^2700 REM2705 REM                                     **** QUERY & CHECK ID  ****2710 REM2715 I$=A$2720 A$="ID?"2725 GOSUB 5002730 GOSUB 6002735 B$=SEG(B$,1,15)2740 IF B$=I$ THEN 27652745 E$="ERROR - ID incorrect ("2750 E$=E$&I$2755 E$=E$&") recd."2760 GOSUB 25002765 RETURN 2800 REM2805 REM                                            **** ALL TESTS  ****2810 REM2811 PRINT "How many loops of ALL do you wish? ";2812 INPUT L82815 PAGE 2816 FOR L9=1 TO L82817 PRINT @D0:"::: ALL Loop ";L9;" of ";L8;" :::"2819 PRINT @D0:2820 FOR F2=2+M0 TO 8+M02825 F3=02830 FOR N4=1 TO N12835 IF T(N4)+1<>F2-M0 THEN 28802840 IF F3=1 THEN 28752845 REM ^^ F3=1 means test already appended ^^2850 DELETE 4001,99992855 FIND F22860 X9=MEMORY2865 APPEND 40002870 F3=12875 GOSUB 40002880 NEXT N42885 NEXT F22886 PRINT @D0:2887 PRINT @D0:2888 NEXT L92890 RETURN 2900 REM2905 REM                                     *** SERIAL POLL ROUTINE ***2910 REM2915 REM ** This routine will perform a serial POLL of the devices **2920 REM ** listed in the Instrument List.                         **2925 REM2930 REM2935 S$=" "2940 FOR I7=1 TO N12945 Z$=" "2950 IF T(I7)=0 THEN 32102955 POLL D,S9;P(I7)2960 PRINT @P(I7):"ERR?;"2965 CALL "WAIT",0.252970 INPUT @P(I7):E$2975 IF F1=0 THEN 30002980 S7=S92985 X$=SEG(T$,10*(T(I7)-1)+4,7)2990 IF D=0 THEN 30002995 Z$="<<SRQ>>"3000 S=03005 FOR I0=8 TO 1 STEP -13010 IF S9<2^(I0-1) THEN 30253015 S(I0)=13020 S9=S9-2^(I0-1)3025 NEXT I03030 REM --- Let S9= value of lower four bits  ---3035 FOR I0=4 TO 1 STEP -13040 IF S(I0)=0 THEN 30503045 S9=S9+2^(I0-1)3050 NEXT I03055 REM --- Determine type of status ----3060 IF S(8)=1 THEN 31553065 IF S(6)=1 THEN 31153070 REM --- System Normal status ----3075 GO TO S9 OF 3085,30953080 GO TO 31053085 S$="Power Up"3090 GO TO 31953095 S$="Remote Request"3100 GO TO 31953105 S$="Undefined System Normal status"3110 GO TO 31953115 REM --- System Abnormal status ----3120 GO TO S9 OF 3130,3140,3150,3160,3170,31803125 GO TO 31903130 S$="Command Error"3135 GO TO 31953140 S$="Execution Error"3145 GO TO 31953150 S$="Internal Error"3155 GO TO 31953160 S$="Power Fail"3165 GO TO 31953170 S$="Execution Warning"3175 GO TO 31953180 S$="Internal Warning"3185 GO TO 31953190 S$="Undefined System Abnormal status"3195 IF F1=0 THEN 32103200 W$="7A,1X,7A,9A,1X,2D,/,17X,6A,1X,3D,1X,1A,FA,1A,/,17X,FA,/"3205 PRI @D0: USI W$:Z$,X$,"@ Address",P(I7),"Status",S7,"(",S$,")",E$3210 NEXT I73215 RETURN 3300 REM3305 REM                                   **** DATA LOGGING SELECT ****3310 REM3315 PAGE 3320 PRINT "You have the choice of logging test names and error"3325 PRINT "messages to the terminal screen or to a line printer."3330 PRINT 3335 PRINT "Enter the number which represents your choice:"3340 PRINT 3345 PRINT "   32...Log data to terminal screen"3350 PRINT "   XX...Log data to line printer - XX = ROM Pack address.";3352 PRINT " (41, 51, etc.)"3355 PRINT 3360 PRINT "Enter choice -> ";3365 INPUT D03370 IF D0=32 OR D0=41 OR D0=51 OR D0=61 OR D0=71 THEN 33903375 PRINT D0;" isn't a recognized terminal screen or ROM Pack address."3380 PRINT "Please try again."3385 GO TO 33303390 RETURN 4000 REM                             **** OVERLAY TEST PROGRAM HERE ****