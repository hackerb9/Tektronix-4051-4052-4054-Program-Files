1 GO TO 10050 REM ** Port of C64 ADVENTURE64 300 point abridged version **51 REM ** Monty McGraw, April 3, 2021, requires AUXMEM and MFM**52 REM    *** New Variables53 REM    N$ = Tek4907 floppy disk filename with Scratchlib path54 REM    S$ = S$() object string array /w END OF STRING PTRs IN S9()55 REM    I$ = I$() object string array /w END OF STRING PTRs IN I9()56 REM    X  = replacement for I as program uses I as a STRING array57 REM    V$ = replacement for IV$ array with V9() string end pointers58 REM    G$ = replacement for E$ (Tek BASIC only has 1 ltr strings59 REM    H$ = replacement for F2$60 REM    *** %(integer) Variable Substitutions ***62 REM        D%()= D0()63 REM        D%  = D864 REM        I%()= I0()65 REM        I%  = I866 REM        K%()= K0()68 REM        M%()= M0()70 REM        S%()= S0()72 REM        T%()= T0()74 REM         K()= K5() to avoid collision with K simple variable75 REM          M0= M1   AS M0() IS DEFINED80 REM  function replaces CALL BITTES V1=value, X is bit number90 ON EOF(6) THEN 9595 F3=1096 GO TO 4480100 INIT101 DEF FNB(X)=INT(V1/2^X-INT(V1/2^X)+0.5)102 PAGE103 ON EOF (6) THEN 90104 REM initialize Tek 4050 RND number generator105 B=RND(-1)106 B=RND(1)107 DIM N$(40)108 REM    N$=filename so insert path: N$=REP("@SCRATCHLIB/",1,0)109 REM    OPEN N$;1,"F",Z$          : Z$ is returned status   110 REM DATA  162,6,32,198,255,32,228,255,201,35,208,249,76,204,255120 REM FOR J=900 TO 914: READ X: POKE J, X: NEXT J130 K1=131132 DIM K0(K1),K5(K1),D0(5)134 DATA 0,0,"",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0135 DATA 0,0,"",0,0,"",0,0,0,0,0136 READ T,D2,F$,F3,L,F9,B2,L2,C,M1,R0,B0,X0,L3,L4,L7,L8,L9,A,B137 READ B1,B3,B4,D,D8,G,H,I8,J2,J3,J4,K6,K7,K$,L4,L9,L$,P1,R0,V,Z,Z8139 D0=0140 S1=114142 DIM S0(S1+1),T0(S1),S$(4285),S9(S1),M0(S1,10)150 I1=38155 DIM I0(I1),I$(1580),I9(I1),V$(505),V9(I1)162 PRINT "Welcome ";163 REM CALL "MOUNT",1,A$164 REM CALL "UNIT",1170 REM advf0-31 AUXMEM filenumber =advf#+10171 CALL"SETIP",1,1172 FOR J=1 to K1174 CALL "READ",1,K0(J),K5(J)176 NEXT J178 REM CLOSE 1180 PRINT "to ";185 REM advkeys=1,shor$=2,shor#=3,advmap=4,itm-desc=5,itm-room=6,name=7186 S$=""187 CALL"SETIP",2,1188 CALL"SETIP",3,1189 FOR J=1 to S1190 CALL "READ",2,M$191 CALL "READ",3,T0(J)194 S$=S$&M$195 X=LEN(S$)196 S9(J)=X197 NEXT J198 REM CLOSE 1200 PRINT "Adventure";210 CALL "SETIP",4,1212 FOR J=1 to S1213 K=1214 CALL"READ",4,M0(J,K),M0(J,K+1),M0(J,K+2),M0(J,K+3),M0(J,K+4)215 K=6216 CALL"READ",4,M0(J,K),M0(J,K+1),M0(J,K+2),M0(J,K+3),M0(J,K+4)218 NEXT J219 REM CLOSE 1220 PRINT "!"221 I$=""222 CALL "SETIP",5,1223 CALL "SETIP",6,1224 CALL "SETIP",7,1230 REM232 FOR J=1 to I1233 CALL"READ",5,M$234 I$=I$&M$235 X=LEN(I$)236 I9(J)=X237 NEXT J240 FOR J=1 to I1242 CALL"READ",6,I0(J)244 NEXT J245 V$=""250 FOR J=1 to I1253 CALL "READ",7,M$254 V$=V$&M$255 I=LEN(V$)256 V9(J)=I257 NEXT J258 REM CLOSE 1260 L1=6262 L5=1e6264 L6=149266 B0=1267 S0=0268 S0(0+1)=1270 Z$="y"272 PRINT "Do you want instructions? ";274 INPUT Z$280 F1=0290 IF Z$<>"Y" THEN 330300 PAGE302 GOSUB 4460310 F1=F1+1312 IF F1<>4 THEN 320314 REM CLOSE 6316 GO TO 327318 Z$="y"320 PRINT "More instructions? ";321 INPUT Z$322 GO TO 290323 PRINT "  SAVE  - save your current position;"324 PRINT "  LOAD  - load in a previously"325 PRINT "          saved position."326 Z$="y"327 PRINT "Ready to start? ";328 INPUT Z$329 IF Z$<>"Y" THEN 270330 J1=0340 REM PAGE342 K9=18344 GOSUB 4260345 V1=T0(L1)347 U=FNB(1)348 IF U>0 OR (I=-1 AND L=1) THEN 360350 F1=13352 GO TO 2930360 IF S0(L1+1)=5 THEN 380370 IF S0(L1+1)>0 OR F9>J1 THEN 390380 U=FNB(7)381 IF U<>0 THEN 390382 F1=L1+200384 S0(L1+1)=0386 GOSUB 4460388 GO TO 400389 REM extract and print S$(L1)390 X0=1393 X1=S9(L1)394 IF L1=1 THEN 396395 X0=S9(L1-1)+1396 M$=SEG(S$,X0,X1-X0+1)399 PRINT M$400 S0(L1+1)=S0(L1+1)+1405 GOSUB 3740410 IF I0(27)<>-1 THEN 420412 F1=50414 GOSUB 4460420 IF M1=0 THEN 4410430 GOSUB 3570431 PRINT "Action: ";432 V1=T0(L1)434 INPUT A$435 M$=SEG(A$,1,4)436 IF M$="LOAD" THEN 5000438 IF M$="SAVE" THEN 6000439 IF M$="HELP" THEN 270440 A=LEN(A$)441 FOR A0=1 TO 1442 FOR J=1 TO A444 M$=SEG(A$,J,1)445 IF M$<>" " THEN 450446 NEXT J450 NEXT A0451 K9=0452 J1=J454 IF J>A THEN 420460 FOR A0=1 to 1461 FOR J=J1 TO A463 M$=SEG(A$,J,1)464 IF M$=" " THEN 470465 NEXT J470 NEXT A0471 J2=J-J1472 IF J>A THEN 481473 FOR A0=1 TO 1474 FOR J=J TO A475 M$=SEG(A$,J,1)476 IF M$<>" " THEN 480478 NEXT J480 NEXT A0481 IF J<=A THEN 490482 J3=J1484 J4=J2486 GO TO 510490 J3=J491 FOR A0=1 to 1492 FOR J=J3 TO A493 M$=SEG(A$,J,1)494 IF M$=" " THEN 500496 NEXT J500 NEXT A0501 J4=J-J3510 L$=SEG(A$,J3,J4)512 B=0513 FOR A0=1 to 1514 FOR J=1 TO 5515 M$=SEG(L$,J,1)516 B=B*26+ASC(M$)-64520 IF J=>LEN(L$) THEN 530525 NEXT J530 NEXT A0531 FOR A0=1 to 1532 FOR J=1 TO 77535 IF B=K5(J) THEN 549540 NEXT J541 NEXT A0542 IF L$<>"it" AND L$<>"them" THEN 550544 K9=K8546 GO TO 560549 NEXT A0550 K9=K0(J)552 K7=J554 IF K9<=199 THEN 560556 K9=0560 K8=K9562 IF K9<=99 OR K9=154 THEN 570564 K=K9566 GO TO 750570 K$=SEG(A$,J1,J2)571 B=0572 FOR A0=1 to 1573 FOR J=1 TO 5575 M$=SEG(K$,J,1)576 B=B*26+ASC(M$)-64580 IF J=>LEN(K$) THEN 590585 NEXT J590 NEXT A0591 FOR A0=1 to 1592 FOR J=51 TO K1595 IF B=K5(J) THEN 650600 NEXT J601 NEXT A0602 IF K9<>0 THEN 610604 PRINT "I don't know that word."606 GO TO 420610 IF K6<=0 THEN 620612 K=K6613 NEXT A0614 GO TO 730620 GOSUB 4260622 IF I>0 THEN 420630 J=K7632 IF K9<=0 THEN 640634 PRINT "What do you want to do with the ";L$;"?"636 GO TO 420640 PRINT "I don't know how to do that."645 GO TO 420650 NEXT A0651 K=K0(J)652 K6=0654 IF K9>0 OR K<299 THEN 730660 IF K<>304 THEN 670662 J1=1664 J2=34666 GO TO 690670 IF K<>307 THEN 680672 J1=35674 J2=38676 GO TO 690679 NEXT A0680 K6=K682 PRINT K$;" what?"684 GO TO 420690 FOR A0=1 to 1691 FOR J=J1 TO J2695 IF I0(J)<>L1 THEN 720700 IF K9>0 THEN 679710 K9=J720 NEXT J724 NEXT A0725 IF K9=0 THEN 680730 IF K9<>39 THEN 740732 F1=101734 GO TO 2930740 IF K9<=0 OR K9=>35 THEN 750742 GOSUB 4260744 IF I>=0 THEN 1820750 M1=0755 IF K>99 AND K<110 THEN 860760 IF K=>200 OR L5=>50 THEN 765762 PRINT "Please exit by main entrance only."764 GO TO 420765 IF K9<>32 OR L1<=112 THEN 770767 F1=128769 GO TO 2930770 GO TO K-149 OF 1660,1690,1710,1900,1920,1960,3510,840,3410780 GO TO K-199 OF 2140,1830,4570,2250,2290,2310,2970,3030,3420,3540790 GO TO K-209 OF 3550,3560,4670,1650,420,2000,2030,3260,3310,3330800 GO TO K-219 OF 3380,3390810 GO TO K-299 OF 1980,2060,2190,2230,2340,2500,2610,2740,2850,3120820 GO TO K-309 OF 3220,3460,3480,1740,1770840 FOR A0=1 TO 1841 FOR J=1 TO 10842 IF L2<>M0(L1,J) THEN 850844 L9=L2846 GO TO 899850 NEXT J851 NEXT A0852 PRINT "I've forgotten which way I came."854 GO TO 420860 M1=1865 D=K-99870 IF L>0 THEN 890880 K9=18882 GOSUB 4260883 U=FNB(2)884 U1=FNB(1)889 IF U=1 AND U1=0 THEN 2040890 L9=M0(L1,D)892 IF L9<>0 THEN 900894 PRINT "You can't go that way."896 GO TO 420899 NEXT A0900 IF I0(37)<>L1 OR L9=L2 THEN 910902 PRINT "You can't get by the snake"904 GO TO 420910 IF I0(36)<>L1 OR L9=L2 THEN 920912 F1=53914 GO TO 2930920 IF ABS(L1-L9)>1 THEN 1010930 IF (L1+L9)<>21 OR G<>0 THEN 940932 F1=100934 GO TO 2930940 IF (L1+L9)<>39 OR B2<>0 THEN 950942 F1=102944 GO TO 2930950 IF L1+L9<>115 THEN 980960 FOR A0=1 to 1961 FOR J=1 TO I1962 IF J<>10 AND I0(J)=-1 THEN 970964 NEXT J965 NEXT A0966 GO TO 980970 NEXT A0971 F1=120975 GO TO 2930980 IF L1+L9=121 THEN 1200990 IF (L1+L9)<>147 OR D2<>0 THEN 1000992 F1=130994 GO TO 29301000 IF L1<>17 OR I0(1)<>-1 THEN 10101002 F1=1031004 GO TO 29301010 IF L1<>40 OR L9<>37 THEN 10401020 F1=571022 J=251024 IF I0(25)=-1 THEN 10301026 J=311028 F1=581030 IF I0(J)=-1 THEN 29301040 IF L9<>255 THEN 10501045 GOSUB 12601050 L2=L11052 L1=L91054 IF L1<10 THEN 10901060 L5=L5-11065 IF L5<>50 THEN 10801070 FOR J=17 TO 23 STEP 21071 I0(J)=01072 NEXT J1073 I0(16)=01074 G=01075 B0=01076 B2=01077 F1=551078 GOSUB 44601080 IF L5<>0 THEN 10901082 F1=561084 GOSUB 44601085 FOR J=16 TO 211086 I0(J)=01087 NEXT J1088 L1=1131089 GO TO 3301090 L6=L6-L1095 IF L6>75 OR I0(33)>-1 THEN 11101100 L6=1e91102 I0(33)=01104 I0(34)=-11106 F1=111108 GOSUB 44601110 IF L6=>0 THEN 11201112 F1=1041114 GO TO 46601120 IF L6<>75 THEN 11301122 F1=101124 GOSUB 44601125 U=FNB(6)1130 IF U>0 THEN 3301140 FOR J=0 TO 41142 D8=D0(J+1)1144 IF D8<0 OR D8=L1 THEN 11801150 IF D8<>L2 THEN 11601152 IF L1<=17 OR (L1=>58 AND L1<=69) THEN 11601154 D8=L11156 GO TO 11701160 D8=INT(RND(1)*84+17)1162 IF D8<=57 THEN 11701164 D8=D8+121170 D0(J+1)=D81180 NEXT J1190 GO TO 3301200 IF B3<>1 THEN 12101202 D=01204 GO TO 8901210 IF T<>1 OR I0(35)<>L1 THEN 12301212 T=01214 F1=1101216 GO TO 29301230 F1=1051235 IF T=0 THEN 29301240 IF I0(27)<>-1 THEN 12501242 B3=11244 S0(66+1)=11246 F1=191247 GOSUB 44601248 GO TO 45901250 GO TO 10001260 IF L1=44 THEN 12901270 IF D=7 OR RND(1)>.1 THEN 13501280 L9=381285 GO TO 13701290 IF RND(1)<.5 THEN 13501300 L9=331302 J=RND(1)1304 IF J<.2 THEN 13701310 L9=371315 IF J<.4 THEN 13701320 L9=451325 IF J<.6 THEN 13701330 L9=921335 IF J<.8 THEN 13701340 L9=761345 GO TO 13701350 PRINT "You have crawled thru some little holes";1352 L9=L11360 PRINT " and ended up in the main passage."1370 RETURN1380 K=B41390 IF I0(26)<>39 THEN 14001395 K=K+11400 J2=-21402 IF D0(4+1)<0 OR I0(15)<=0 THEN 14101404 J2=I0(15)1410 V=101412 FOR J=1 TO 151414 J1=I0(J)1420 IF J1<>-1 THEN 14301422 K=K+V/21424 GO TO 14601430 IF J1<>7 THEN 14401432 K=K+V1434 GO TO 14501440 IF J1<>J2 THEN 14501445 K=K+INT(V/4)1450 IF S0(J1+1)<=0 THEN 14601455 K=K+11460 IF J<>5 THEN 14701465 V=201470 NEXT J1480 FOR J=0 TO 31482 IF D0(J+1)=>0 THEN 14901484 K=K+61490 NEXT J1500 K=K-R0*3-H+(L1>10)*21510 J1=K1512 B$="a beginning"1514 K=K-201516 IF K<0 THEN 15601520 B$="a novice"1522 K=K-301524 IF K<0 THEN 15601530 B$="a seasoned"1532 K=K-501534 IF K<0 THEN 15601540 B$="an advanced"1542 K=K-801544 IF K<0 THEN 15601550 B$="an expert"1560 PRINT "Your score is ";J1;" out of a possible ";1570 PRINT "300, which rates you as"1580 PRINT B$;" adventurer."1590 IF K<0 THEN 16201600 IF J1<300 THEN 16101605 PRINT "Congratulations on a perfect score!"1610 GO TO 16401620 PRINT "To achieve the next higher rating, you ";1630 PRINT "will need ";-K;" more points."1640 RETURN1650 GOSUB 13801655 GO TO 4201660 IF L1<>7 AND L1<>26 THEN 16801670 L9=33-L11675 GO TO 10501680 PRINT "Nothing happens."1685 GO TO 4201690 IF L1<>7 AND L1<>13 THEN 16801700 L9=20-L11705 GO TO 10501710 IF L1<>26 AND L1<>58 THEN 16801720 IF I0(10)<>-1 THEN 17301725 I0(10)=581730 L9=84-L11735 GO TO 10501740 F1=1061745 IF K9=26 THEN 29301750 F1=1071755 IF K9<>31 OR L1<113 THEN 29301760 F1=821762 GOSUB 44601764 GOSUB 37101766 GO TO 4201770 F1=1081775 IF K9<>41 THEN 29301780 F1=1091785 IF L1=80 THEN 29301790 IF L1<113 THEN 18201800 F1=801805 GOSUB 44601810 F1=691815 GO TO 46601820 PRINT "I see no ";L$;" here."1825 GO TO 4201830 U=FNB(5)1831 IF K9=16 AND U>0 THEN 22601840 D=01842 IF L1=19 THEN 18501844 D=71850 IF L1=20 THEN 18601855 D=31860 IF L1=60 THEN 18701865 D=21870 IF L1=61 THEN 18801875 D=61880 GO TO 8901890 GO TO 16801900 IF L1>10 THEN 16801910 L9=71915 GO TO 10501920 IF L1<5 OR L1>9 THEN 19401930 L9=101935 GO TO 10501940 IF L1<12 OR L1>16 THEN 16801950 L9=111955 GO TO 10501960 IF L1<25 OR L1>32 THEN 16801970 L9=261975 GO TO 10501980 IF K9<>18 THEN 19901982 F1=171984 GO TO 29301990 PRINT "Peculiar.  ";1995 GO TO 16802000 IF L1=50 THEN 20102002 D=92004 GO TO 8902010 D=02015 IF P1<>2 THEN 8902020 L9=702025 GO TO 9202030 U=FNB(2)2031 IF U=0 THEN 16802040 F1=182042 GOSUB 44602044 GO TO 45902050 IF I0(21)<>L1 OR I0(K9)<>L1 THEN 20602052 I0(21)=-12054 I0(K9)=-12056 GO TO 24902060 IF I0(21)=-1 THEN 20702062 B$="bottle"2064 GO TO 21102070 IF K9<>6 THEN 20802072 F1=522074 GO TO 29302080 U=FNB(5)2081 IF U=0 THEN 20902082 B0=12084 I0(16)=-12086 I0(17)=02088 GO TO 21302090 IF L1<>49 THEN 21002092 B0=22094 I0(17)=-12096 I0(16)=02098 GO TO 21302100 GO TO 21202110 PRINT "You have no ";B$2112 GO TO 4202120 PRINT "Nothing to fill here."2122 GO TO 4202130 PRINT "The bottle is filled."2132 GO TO 4202140 IF I0(21)<>-1 THEN 20602150 IF L1=50 AND I0(16)<0 THEN 29902160 PRINT "The bottle is empty."2170 IF I0(16)+I0(17)<>-1 THEN 21802172 F1=712174 GOSUB 44602180 B0=02182 I0(17)=02184 I0(16)=02186 GO TO 4202190 IF K9<>18 THEN 22202200 L=12201 U=FNB(1)2202 IF U=0 THEN 3302210 GO TO 24902220 PRINT "I don't understand."2222 GO TO 4202230 IF K9<>18 THEN 22202240 L=02242 GO TO 24902250 U=FNB(5)2251 IF K9<>16 OR U=0 THEN 22702260 F1=712262 GO TO 29302270 IF L1<>6 AND L1<>68 THEN 22752271 D=32272 GO TO 8902275 IF L1<>10 THEN 22802276 D=102277 GO TO 8902280 GO TO 16802290 IF L1<>7 AND L1<>69 THEN 23002292 D=72294 GO TO 8902300 GO TO 16802310 FOR A0=1 to 12311 FOR J=1 TO I12312 IF I0(J)<=-1 THEN 23192314 NEXT J2315 NEXT A02316 PRINT "You are carrying nothing."2318 GO TO 4202319 NEXT A02320 J1=J2322 PRINT "You have: "2324 FOR J=I1 TO J1 STEP-12325 IF I0(J)<>-1 OR J=27 THEN 23382326 X0=12328 X1=V9(J)2330 IF J=1 THEN 23342332 X0=V9(J-1)+12334 M$=SEG(V$,X0,X1-X0+1)2336 PRINT M$2338 NEXT J2339 GO TO 4202340 IF K9=16 OR K9=17 THEN 20502350 Z8=02352 FOR J=1 TO I12354 IF I0(J)<>-1 THEN 23602356 Z8=Z8+12360 NEXT J2362 IF Z8<7 OR K9=27 THEN 23802370 PRINT "You're carrying too much."2372 GO TO 4202380 F1=442385 IF K9=14 AND I0(36)>0 THEN 29302390 F1=382395 IF (K9=12 OR K9=27 OR K9=28) AND B1=0 AND I0(27)=L1 THEN 29302400 F1=1162405 IF (K9=12 OR K9=27) AND C=0 THEN 29302410 IF K9<>42 THEN 24202412 IF L1<>50 AND L1<=112 THEN 24202414 F1=762416 GO TO 29302420 IF K9<>32 OR I0(23)<>-1 THEN 24302422 F1=202424 GO TO 29302430 IF K9<>32 OR I0(22)<0 THEN 24502440 F1=1112445 GO TO 29302450 IF K9<=34 THEN 24602452 PRINT "You must be joking!"2454 GO TO 4202460 I0(K9)=-12470 IF K9<>21 OR B0<=0 THEN 24802475 I0(B0+15)=-12480 IF K9<>31 OR L1<>113 THEN 24902482 PRINT "Ok."2484 F1=812486 GO TO 29302490 PRINT "Ok."2495 GO TO 4202500 IF K9=16 OR K9=17 THEN 21402505 IF K9>34 THEN 22202510 I0(K9)=L12512 IF K9<>21 OR B0<=0 THEN 25202514 I0(15+B0)=L12520 IF L1<=112 THEN 25302522 GOSUB 43402524 IF I=>0 THEN 25302526 I0(K9)=02530 IF K9<>16 AND K9<>17 THEN 25402532 B0=02534 I0(K9)=02540 IF K9<>22 OR I0(32)<>-1 THEN 25502545 I0(32)=L12550 IF K9<>4 OR L1<>100 THEN 25602552 I0(K9)=02554 I0(33)=L12556 GO TO 27302560 IF K9<>6 THEN 25802570 IF I0(29)=L1 THEN 25802572 F1=142574 GOSUB 44602576 I0(K9)=02578 I0(30)=L12580 IF K9=32 THEN 31202590 IF K9<>27 OR T>0 OR I0(35)<>L1 THEN 24902600 T=22602 F1=312604 GO TO 29302610 IF K9>15 OR I0(35)<>L1 THEN 26302620 I0(35)=121-L12622 I0(K9)=02624 T=12626 F1=542628 GO TO 29302630 IF K9=20 AND I0(27)=L1 THEN 29602640 IF K9<>28 THEN 25002650 IF I0(35)<>L1 THEN 26602652 F1=162654 GO TO 29302660 IF I0(27)<>L1 OR B1<>0 THEN 26702662 F1=772664 GO TO 29302670 FOR A0=1 TO 12671 FOR J=0 TO 32672 IF D0(J+1)=L1 THEN 26792674 NEXT J2675 NEXT A02676 GO TO 25002679 NEXT A02680 IF RND(1)=>.5 THEN 26902682 PRINT "Missed!"2684 GO TO 27202690 PRINT "You killed a little dwarf"2692 J2=J2693 FOR A0=1 to 12694 FOR J=1 TO 32696 IF D0(J+1)<0 THEN 27102700 NEXT J2701 NEXT A02702 F1=402704 GOSUB 44602706 GO TO 27112710 NEXT A02711 D0(J2+1)=-12720 I0(28)=L12725 J1=02730 GOSUB 38902735 GO TO 4202740 IF K9<I1 AND I0(K9)<>L1 THEN 18202741 IF K9<>I1 THEN 27452742 GOSUB 43902744 IF J1=0 THEN 18202745 IF K9<>36 THEN 27902750 PRINT "With what?  Your bare hands: ";2752 INPUT A$2760 IF A$<>"AXE" THEN 27702762 F1=992764 GO TO 29302770 M$=SEG(A$,1,1)2771 IF M$<>"Y" THEN 4402780 I0(36)=02782 I0(38)=L12784 F1=422786 GO TO 29302790 IF K9<>35 THEN 28002792 F1=362794 GO TO 29302800 IF K9<>38 THEN 28102802 F1=512804 GO TO 29302810 IF K9<>32 THEN 28202812 I0(K9)=02814 S0(23+1)=12816 F1=642818 GO TO 29302820 IF K9<>27 THEN 28302822 F1=78+SIGN(B1)2824 GO TO 29302830 F1=1132832 IF K9<=31 THEN 28402834 F1=1122840 GO TO 29302850 IF K9<>25 AND K9<>31 THEN 28602852 F1=982854 GO TO 29302860 IF K9=27 THEN 29502870 F1=392872 IF K9<=31 THEN 28802874 GO TO K9-31 OF 2890,2220,2220,2900,2910,2920,29302880 GO TO 22202890 F1=212895 GO TO 29302900 F1=372905 GO TO 29302910 F1=352915 GO TO 29302920 F1=352925 IF I0(32)=-1 THEN 29402930 GOSUB 44602935 GO TO 4202940 I0(32)=02942 F1=452944 GO TO 29302950 B$="food"2955 IF I0(20)>-1 THEN 21102960 B1=12962 I0(20)=02964 F1=342966 GO TO 29302970 B$="water"2972 IF L1<>50 THEN 6202980 IF I0(16)>-1 THEN 21102990 I0(16)=02992 B0=02994 IF P1=3 THEN 16803000 P1=P1+13002 IF P1<>1 THEN 30103004 F1=323006 GO TO 29303010 IF P1<>2 THEN 30203012 F1=333014 GO TO 29303020 F1=723025 GO TO 29303030 B$="keys"3035 IF L1=10 OR L1=11 THEN 30503040 M$=SEG(K$,1,1)3045 IF L1<>69 OR M$<>"U" THEN 16803050 IF I0(19)>-1 THEN 21103060 IF L1=69 THEN 30903070 G=03074 M$=SEG(K$,1,1)3075 IF M$<>"U" THEN 30803076 G=13080 GO TO 24903090 IF B1<>0 THEN 31003092 F1=383094 GO TO 29303100 IF C<>0 THEN 31103102 C=13104 B1=23110 F1=1213115 GO TO 29303120 IF K9<>32 THEN 31803130 FOR A0=1 to 13131 FOR J=36 TO 373135 IF I0(J)=L1 THEN 31493140 NEXT J3141 NEXT A03145 I0(K9)=L13146 GO TO 24903149 NEXT A03150 IF J=36 THEN 31703160 I0(J)=03162 I0(K9)=L13164 F1=223166 GO TO 29303170 I0(K9)=03172 F1=233174 GO TO 29303180 IF K9<>27 THEN 22203190 IF I0(K9)=-1 THEN 25003200 IF C<>0 THEN 32103205 K$="u"3206 GO TO 30303210 GO TO 22203220 IF K9<>23 THEN 16803230 IF ABS(L1-19.5)>1 THEN 16803240 F1=114+B23242 B2=1-B23244 GO TO 29303260 IF L1<>10 AND L1<>11 AND L1<>114 THEN 32703262 K$="u"3264 GO TO 30303270 F1=1173275 IF K9<>25 AND K9<>31 THEN 29303280 F1=1183282 IF I0(9)>-1 THEN 29303290 F1=633295 IF K9=31 THEN 29303300 I0(7)=433302 I0(25)=03304 I0(31)=L13306 F1=413308 GO TO 29303310 IF L1=10 OR L1=11 THEN 30303320 GO TO 16803330 F1=1193335 IF L1<113 THEN 29303340 F1=663245 IF L1=114 AND I0(24)=113 THEN 33703350 F1=673355 IF L1=113 AND I0(24)=0 THEN 33703360 F1=683370 B4=(68-F1)*10+23375 GO TO 46603380 PRINT "Watch it!"3385 GO TO 4203390 IF L1<>113 THEN 34003392 F1=463394 GOSUB 44603396 GO TO 18103400 GO TO 16803410 F1=473415 GO TO 29303420 B$="oil"3421 IF L1<>50 THEN 34253422 F1=1293423 GO TO 29303425 IF L1<>73 THEN 6203430 IF D2=1 THEN 16803440 IF B0<2 THEN 21103450 D2=13452 I0(17)=03454 B0=03456 F1=433458 GO TO 29303460 F1=1223465 IF K9<>20 THEN 29303470 I0(K9)=03472 F1=1233474 GO TO 29303480 U=FNB(5)3481 IF U=0 THEN 34903482 F1=653484 GO TO 29303490 F1=1243495 IF K9<>16 THEN 29303500 I0(K9)=03502 F1=1253504 GO TO 29303510 IF L1<>71 THEN 16803520 IF I0(8)<>L1 AND I0(8)<>-1 THEN 35303522 I0(8)=03524 F1=1273526 GO TO 29303530 I0(8)=L13532 I0(35)=603534 T=03536 F1=1263538 GO TO 29303540 F9=23542 F$=""3544 REM CLOSE 63546 GO TO 4203550 F9=03555 GO TO 4203560 F9=13565 GO TO 4203570 U=FNB(3)3571 IF U=1 THEN 35803572 L4=03574 GO TO 37303580 L4=L4+13590 F1=923595 IF L1=15 AND I0(32)=L1 AND I0(23)=-1 AND L4=4 THEN 36703600 F1=883602 IF L1=39 AND L4=8 THEN 36703610 F1=963615 IF L1<9 AND L4=12 AND S0(13+1)=0 THEN 36703620 F1=863625 IF L1>87 AND L4=15 THEN 36703630 F1=843635 IF L1=58 AND L4=4 THEN 36703640 F1=943645 IF L1=10 AND L4=3 AND I0(19)=7 THEN 36703650 F1=903655 IF I0(37)=L1 AND L4=3 AND I0(32)>=0 THEN 36703660 GO TO 37303670 GOSUB 44603671 PRINT "> ";3672 INPUT Z$3674 M$=SEG(Z$,1,1)3675 IF M$="Y" THEN 36803676 L4=03678 GO TO 37303680 PRINT "I am prepared to give you a hint, but"3690 PRINT "it will cost you ";(98-F1)/2;" points."3700 PRINT "Do you want the hint? ";3710 INPUT Z$3711 M$=SEG(Z$,1,1)3712 IF M$="Y" THEN 37203714 L4=03716 GO TO 37303720 H=H+(98-F1)/23722 F1=F1+13724 GOSUB 44603730 RETURN3740 IF L1<>100 THEN 37503741 F1=613742 GOSUB 44603744 IF I>0 THEN 37503746 F1=623748 GOSUB 44603750 U=FNB(4)3751 IF U=0 THEN 38603760 IF I0(1)=-1 THEN 37903770 IF L1<>16 THEN 37803775 PRINT "Rough stone steps lead down to the pit."3780 IF L1<>17 THEN 37903785 PRINT "Rough stone steps lead to the top of the dome."3790 IF B2=0 OR L1<19 OR L1>20 OR L1+L2=39 THEN 38103800 PRINT "A crystal bridge spans the fissure."3810 IF L1<>73 OR D2<>0 THEN 38203815 PRINT "A rusty door obstructs passage to north"3820 IF L1<60 OR L1>61 OR L1+L2=121 THEN 38603830 IF B3<>1 THEN 38403832 F1=603834 GOSUB 44603836 GO TO 38603840 F1=303842 GOSUB 44603850 IF T<=0 THEN 38603855 PRINT "There is no sign of the troll."3860 GOSUB 43903865 IF D0(0+1)<0 OR J1=0 THEN 38903870 F1=123875 GOSUB 44603880 I0(28)=L13882 FOR J=0 TO 33884 D0(J+1)=J-13886 NEXT J3890 FOR J=1 TO I13895 IF L1<>I0(J) THEN 39703900 IF J<>27 THEN 39203910 IF B1<>0 THEN 39203911 F1=1313912 GOSUB 44603914 RETURN3920 IF J=35 AND T<>0 THEN 39703930 IF J<>15 THEN 39403935 D0(5)=-13940 IF J=12 AND C=0 THEN 39703950 IF J=21 AND B0>0 THEN 39703952 X0=13954 X1=I9(J)3956 IF J=1 THEN 39603958 X0=I9(J-1)+13960 M$=SEG(I$,X0,X1-X0+1)3962 PRINT M$3964 K8=J3970 NEXT J3980 IF S0(40+1)=0 OR I0(15)=0 OR L5<99 THEN 40203990 FOR A0=1 to 13991 FOR J=1 TO 153992 J2=I0(J)3994 IF J2<1 THEN 40104000 IF S0(J2+1)=0 THEN 40194010 NEXT J4015 L5=604019 NEXT A04020 IF L1<10 OR L1>11 THEN 40504030 IF G<>0 THEN 40404035 PRINT "The grate is locked."4040 IF G<>1 THEN 40504045 PRINT "The grate is open."4050 IF L1<>26 OR RND(1)<=.7 THEN 40604055 PRINT "A hollow voice says 'plugh'."4060 IF L1<>50 THEN 40804070 IF P1=>3 THEN 40804072 F1=73+P14074 GOSUB 44604080 IF L1<47 OR L1>49 OR (L2>46 AND L2<51) THEN 41104090 IF P1<>1 AND P1<>2 THEN 41104092 F1=132+P14094 GOSUB 44604110 IF I0(27)<>L1 THEN 41304120 IF C<>0 THEN 41304122 F1=1324124 GOSUB 44604130 GOSUB 43904135 IF J1=0 THEN 41704140 IF J1=1 THEN 41604150 PRINT "There are ";J1;" threatening dwarves here!"4155 GO TO 41704160 PRINT "There is a threatening dwarf here!"4170 IF D0(5)<>L1 THEN 42504180 J2=04182 FOR J=1 TO 144184 IF I0(J)<>-1 THEN 41904186 J2=J2+14190 NEXT J4192 IF J2=>2 OR RND(1)=>.3 THEN 42004194 F1=704196 GOSUB 44604200 IF J2<2 THEN 42504210 F1=154215 GOSUB 44604220 I8=I0(15)4222 IF I8<>0 THEN 42304224 I8=INT(RND(1)*10)+1024226 I0(15)=I84230 FOR J=1 TO 144232 IF I0(J)<>-1 THEN 42404234 I0(J)=I84240 NEXT J4242 D0(5)=I84250 RETURN4260 I=04262 IF K9>I1 THEN 42704264 I=I0(K9)4266 IF I=-1 THEN 43304270 IF (K9<>23 AND K9<>33) THEN 42804272 IF I0(K9+1)<>-1 THEN 42804274 K9=K9+14276 I=-14278 GO TO 43304280 IF I<>L1 THEN 42904282 I=-14284 GO TO 43304290 V1=T0(L1)4291 U=FNB(5)4292 IF K9<>16 OR U=0 THEN 43004293 I=-14300 IF K9<>17 OR L1<>49 THEN 43104305 I=-14310 IF I<0 OR L1<=112 THEN 43204312 GOSUB 43404320 IF (K9<>23 AND K9<>33) OR I<0 THEN 43304322 K9=K9+14324 GO TO 42604330 RETURN4340 I=04345 IF L1=114 THEN 43704350 IF K9<>18 AND K9<>21 AND K9<>23 AND K9<>31 THEN 43604355 I=-14360 RETURN4370 IF K9<>22 AND K9<>24 AND K9<>29 AND K9<>32 THEN 43804375 I=-14380 RETURN4390 J1=04395 FOR J=0 TO 34397 IF D0(J+1)<>L1 THEN 44004398 J1=J1+14400 NEXT J4405 RETURN4410 GOSUB 43904415 IF J1=0 THEN 44504420 PRINT "A sharp knife is thrown at you!"4430 IF RND(1)<=.2*J1 THEN 44404432 PRINT "It missed!"4434 GO TO 44504440 PRINT "It got you!"4442 GO TO 45904450 GO TO 4304460 F8=INT(F1/10)4465 F2=F1-F8*104466 E$=STR(F8)4470 CALL "SETIP",F8+10,14480 REM IF F$=E$ AND F2>F3 THEN 44994490 REM CLOSE 64492 F$=E$4494 REM OPEN F$;6,"R",M$4499 P=04500 F3=F24501 CALL "READ",F8+10,Z$4502 J=LEN(Z$)4503 IF J<>1 THEN 45114504 K=ASC(Z$)4505 IF K>57 THEN 45304506 K=VAL(Z$)4507 IF K<F2 THEN 45014508 IF K>F2 THEN 45324509 P=14510 GO TO 45014511 IF P=0 THEN 45014512 PRINT Z$4513 GO TO 45014530 IF P=0 THEN 45014532 P=04540 RETURN4570 J1=14572 S0(L1+1)=04574 GO TO 3404590 FOR J=1 TO I14592 IF I0(J)<>-1 THEN 4600 4594 I0(J)=L14600 NEXT J4605 IF L6<25 OR L5<51 THEN 46504610 R0=R0+24612 F1=R0+224614 GOSUB 44604616 INPUT Z$4620 M$=SEG(Z$,1,1)4622 IF M$<>"Y" THEN 46704630 F1=R0+234632 GOSUB 44604634 IF R0>5 THEN 46704640 L1=74642 I0(18)=64644 L=04646 GO TO 3304650 F1=594660 GOSUB 44604670 GOSUB 13804672 REM CLOSE 64690 END5000 PRINT "Input file#(1 to 9) of saved game to LOAD: ";5002 INPUT J5006 REM Save1-9 = Save games = AUXMEM filenumbers 42-505008 CALL "SETIP",J+41,15030 FOR Y=1 TO 1145032 CALL "READ",J+41,T0(Y),S0(Y+1)5034 NEXT Y5040 FOR Y=1 TO 1315042 CALL "READ",J+41,K0(Y),K5(Y)5044 NEXT Y5050 FOR Y=1 TO 385052 CALL "READ",J+41,I0(Y)5054 NEXT Y5070 FOR Y=1 TO 45072 CALL "READ",J+41,D0(Y+1)5074 NEXT Y5080 CALL "READ",J+41,L1,L2,L3,L4,L5,L6,L7,L8,L95090 CALL "READ",J+41,A,A$,B,B1,B2,B3,B4,C,D5100 CALL "READ",J+41,D2,D8,F1,F2,F3,F9,F$,E$,F85110 CALL "READ",J+41,G,H,I,I1,I8,J,J1,J25120 CALL "READ",J+41,J3,J4,K,K1,K6,K7,K8,K9,K$5130 CALL "READ",J+41,L,L1,L2,L4,L5,L6,L9,L$5140 CALL "READ",J+41,M1,P1,R0,S1,T,V,X5150 CALL "READ",J+41,Z,Z8,Z$5900 REM CLOSE 25905 GO TO 4206000 PRINT "Input file#(1 to 9) for SAVE game: ";6002 INPUT J6006 REM ADVPOS1-9 = Save games = AUXMEM filenumbers 42-506010 CALL "SETIP",J+41,16030 FOR Y=1 TO 1146032 CALL "WRITE",J+41,T0(Y),S0(Y+1)6034 NEXT Y6040 FOR Y=1 TO 1316042 CALL "WRITE",J+41,K0(Y),K5(Y)6044 NEXT Y6050 FOR Y=1 TO 386052 CALL "WRITE",J+41,I0(Y)6054 NEXT Y6070 FOR Y=1 TO 46072 CALL "WRITE",J+41,D0(Y+1)6074 NEXT Y6080 CALL "WRITE",J+41,L1,L2,L3,L4,L5,L6,L7,L8,L96090 CALL "WRITE",J+41,A,A$,B,B1,B2,B3,B4,C,D6100 CALL "WRITE",J+41,D2,D8,F1,F2,F3,F9,F$,E$,F86110 CALL "WRITE",J+41,G,H,I,I1,I8,J,J1,J26120 CALL "WRITE",J+41,J3,J4,K,K1,K6,K7,K8,K9,K$6130 CALL "WRITE",J+41,L,L1,L2,L4,L5,L6,L9,L$6140 CALL "WRITE",J+41,M1,P1,R0,S1,T,V,X6150 CALL "WRITE",J+41,Z,Z8,Z$6900 REM CLOSE 26902 PRINT "Saved Ok."6904 GO TO 420