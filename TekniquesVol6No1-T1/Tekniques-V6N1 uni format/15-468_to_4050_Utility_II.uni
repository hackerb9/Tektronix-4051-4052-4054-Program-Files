1 ON SRQ THEN 49002 GO TO 1004 REM*** FK1 RESTART ***5 GOSUB 1006 END 8 REM*** FK2 ACQUIRE WAVEFORMS FORM 468 ***9 GOSUB 510010 GOSUB 120011 RETURN 12 REM*** FK3 ACQUIRE WAVEFORMS FROM TAPE ***13 GOSUB 400014 RETURN 16 REM*** FK4 SAVE WAVEFORMS TO TAPE ***17 GOSUB 440018 RETURN 20 REM*** FK5 REDISPLAY WAVEFORMS ***21 GOSUB 510022 GOSUB 160023 RETURN 24 REM*** FK6 OUTPUT TO SCREEN ***25 D=3226 RETURN 28 REM*** FK7 OUTPUT TO PLOTTER ***29 D=130 RETURN 32 REM *** FK8 MIN/MAX PULSE PARAMETERS ***33 GOSUB 520034 GOSUB 580035 RETURN 36 REM*** FK9 HISTOGRAM OF PULSE PARAMETERS ***37 GOSUB 520038 GOSUB 680039 RETURN 40 REM*** FK10 INTEGRATE WAVEFORM ***41 GOSUB 520042 GOSUB 810043 RETURN 68 REM*** FK17 RMS OF WAVEFORM & PERIOD & RMS OF 1 PERIOD ***69 GOSUB 520070 GOSUB 1020071 RETURN 73 GOSUB 1100074 RETURN 76 REM*** FK19 FFT OF WAVEFORM ***77 GOSUB 520078 GOSUB 940079 RETURN 80 REM*** FK20 DIFFERENTIATE WAVEFORM ***81 GOSUB 520082 GOSUB 860083 RETURN 100 REM*** INITIALIZATION ***110 INIT 120 ON SRQ THEN 4900130 REM*** SET ALTERNATE EOL TO <%> (ASCII 37) ***140 PRINT @37,0:37,255,255150 DIM A$(175),C$(20),X(512),E$(20),D$(20),K$(5),L$(5),M$(5),N$(5)160 DIM O$(5),P$(5),Q$(5),R$(5),S$(5),T$(10),X$(20),Y$(20),Z$(20)170 REM*** SET VALUES FOR X AXIS DATA POINTS ***180 FOR I=1 TO 512190 X(I)=I200 NEXT I210 DATA 32,1,0220 REM*** D=OUTPUT DEVICE J4=IS GRID DRAWN? ***230 READ D,J4,J6240 PRINT "J_ENTER GPIB ADDRESS OF 468 (1-30) ";250 INPUT C$260 C$=C$&"A-1"270 J5=INT(VAL(C$))280 IF J5<1 OR J5>30 THEN 240290 PRINT "J_IS SIGNAL PROCESSING ROM#1 INSTALLED? (YES OR NO) ";300 INPUT C$310 IF LEN(C$)=0 OR POS("YESNO",C$,1)=0 THEN 290320 IF POS("YES",C$,1)>0 THEN 360330 PRINT "J_THIS PROGRAM REQUIRES SIGNAL PROCESSING ROM#1 TO EXECUTE"340 PRINT "         USE ANOTHER PROGRAM. GOODBY!"350 END 360 PRINT "J_IS SIGNAL PROCESSING ROM#2 INSTALLED? (YES OR NO) ";370 INPUT C$380 IF LEN(C$)=0 OR POS("YESNO",C$,1)=0 THEN 360390 IF POS("YES",C$,1)>0 THEN 420400 PRINT "J_THIS PROGRAM REQUIRES SIGNAL PROCESSING ROM#2 TO EXECUTE"410 GO TO 340420 PRINT "J_POWER ON 468 OR CYCLE POWER AT THIS TIME!"430 WAIT 440 PRINT "PRESS /RETURN/ TO START WAVEFORM ACQUISTION ";450 INPUT C$460 J4=1470 PAGE 480 REM*** CALL TO SUBROUTINE TO ACQUIRE DATA ***490 GOSUB 1200500 REM*** SET EOL TO <CR> (ASCII 13) ***510 PRINT @37,26:0520 HOME 530 RETURN 600 REM*** SUBROUTINE TO DRAW SCOPE SCREEN ***610 REM** DASH LINES REPRESENT DIGITIZED DATA AREA NOT ON 468 SCREEN *620 REM*** DIGITIZED AREA IS 10.24cm IN BOTH HORZ. & VERT. ***630 WINDOW 1,500,0,255640 VIEWPORT 30,100,0,70650 FOR I=0 TO 10660 FOR J=7 TO 23 STEP 4670 MOVE @D:50*I+(I=0),J680 DRAW @D:50*I+(I=0),J690 NEXT J700 MOVE @D:50*I+(I=0),27710 DRAW @D:50*I+(I=0),227720 FOR J=231 TO 247 STEP 4730 MOVE @D:50*I+(I=0),J740 DRAW @D:50*I+(I=0),J750 NEXT J760 NEXT I770 FOR I=1 TO 500 STEP 6780 MOVE @D:I,3790 DRAW @D:I,3800 NEXT I810 FOR I=1 TO 500 STEP 6820 MOVE @D:I,64.5830 DRAW @D:I,64.5840 NEXT I850 FOR I=1 TO 500 STEP 6860 MOVE @D:I,189.5870 DRAW @D:I,189.5880 NEXT I890 FOR I=1 TO 500 STEP 6900 MOVE @D:I,252910 DRAW @D:I,252920 NEXT I930 FOR I=1 TO 9940 MOVE @D:1,25*I+2950 DRAW @D:500,25*I+2960 NEXT I970 VIEWPORT 30,100,7.5,62.3980 AXIS @D:10,6.4,250,127990 VIEWPORT 30,100,0,701000 MOVE @D:0,1861010 PRINT @D:"100%"1020 MOVE @D:0,173.21030 PRINT @D:"90%"1040 MOVE @D:0,73.31050 PRINT @D:"10%"1060 MOVE @D:0,60.51070 PRINT @D:"0%"1080 J4=01090 HOME @D:1100 PRINT @D:"J_J_J_ COUPLING"1110 PRINT @D:" TIME/DIV"1120 PRINT @D:" VOLTS/DIV"1130 PRINT @D:" TRIGGER PT."1140 PRINT @D:" MAX VOLTS"1150 PRINT @D:" MIN VOLTS"1160 RETURN 1200 REM*** SUBROUTINE TO ACQUIRE DATA ***1210 SET NOKEY 1220 E$=""1230 DELETE Y,Y1,Y2,Y3,X$,Y$,Z$1240 Q1=MEMORY1250 DATA " "," "," ","",01260 RESTORE 12501270 READ X$,Y$,Z$,A$,J61280 REM*** SET EOL TO <CR><B> ASCII(13,10) ***1290 PRINT @37,26:11300 REM*** UNTALK,UNLISTEN BUS, AND ISSUE DEVICE CLEAR ***1310 WBYTE @95,63,20:1320 REM*** ASSIGN 468 AS TALKER ***1330 WBYTE @64+J5:1340 REM*** GET HEADER USING ALTERNATE DELIMITER OF <%> ***1350 INPUT %J5:A$1360 REM*** CHECK TO MAKE SURE HEADER WAS RECEIVED ***1370 P=POS(A$,"WFID:",5)1380 IF P=0 THEN 13301390 REM*** FIND OUT WHICH CHANNEL DATA WAS FOR ***1400 D$=SEG(A$,P,10)1410 D$=D$&"A3"1420 D$=STR(VAL(D$))1430 REM*** CHECK IF CHANNEL HAS ALREADY BEEN CAPTURED ***1440 IF POS(E$,D$,1)=0 THEN 14601450 GO TO 16001460 E$=E$&D$1470 PRINT @37,26:01480 REM*** DETERMINE NUMBER OF POINTS IN WAVEFORM ***1490 P=POS(A$,"NR.PT:",15)1500 C$=SEG(A$,P+5,5)1510 B=VAL(C$)1520 DELETE Y1530 DIM Y(B)1540 REM*** CAPTURE WAVEFORM ***1550 WBYTE @64+J5:1560 RBYTE H1,H1,Y,C1,H11570 REM*** SAVE DATA ***1580 GOSUB VAL(D$) OF 2000,2100,22001590 GO TO 13201600 REM*** GOSUB TO DRAW WAVEFORMS ***1610 WBYTE @95,63,20:1620 GOSUB LEN(X$)>5 OF 23001630 GOSUB LEN(Y$)>5 OF 25001640 GOSUB LEN(Z$)>5 OF 27001650 SET KEY 1660 RETURN 1700 REM*** SUBROUTINE TO DRAW ACQUIRED WAVEFORM ***1710 GOSUB J4 OF 6001720 WINDOW 1,500,0,2551730 IF B=512 THEN 17501740 WINDOW 1,250,0,2551750 VIEWPORT 30,100,0,701760 MOVE @D:X(1),Y(1)1770 DRAW @D:X,Y1780 RETURN 1800 REM*** SUBROUTINE TO DRAW SAVED WAVEFORM ***1810 GOSUB J4 OF 6001820 WINDOW 1,500,0,2551830 IF B=512 THEN 18501840 WINDOW 1,250,0,2551850 VIEWPORT 30,100,0,701860 FOR I2=1 TO 500*(B>500)+250*(B<300) STEP 3/(1+(B<300))1870 MOVE @D:X(I2),Y(I2)1880 DRAW @D:X(I2),Y(I2)1890 NEXT I21900 RETURN 2000 REM*** SUBROUTINE TO SAVE CHANNEL 1 DATA ***2010 DELETE X$,Y12020 Q1=MEMORY2030 DIM Y1(B),X$(LEN(A$)+5)2040 B1=B2050 Y1=Y2060 X$=A$2070 RETURN 2100 REM*** SUBROUTINE TO SAVE CHANNEL 2 DATA ***2110 DELETE Y$,Y22120 Q1=MEMORY2130 DIM Y2(B),Y$(LEN(A$)+5)2140 B2=B2150 Y2=Y2160 Y$=A$2170 RETURN 2200 REM*** SUBROUTINE TO SAVE ADD DATA ***2210 DELETE Z$,Y32220 Q1=MEMORY2230 DIM Y3(B),Z$(LEN(A$)+5)2240 B3=B2250 Y3=Y2260 Z$=A$2270 RETURN 2300 REM*** SUBROUTINE TO DRAW & ANALYZE CHANNEL 1 DATA ***2310 DELETE Y,A$2320 Q1=MEMORY2330 DIM Y(B1),A$(LEN(X$)+5)2340 Y=Y12350 B=B12360 A$=X$2370 GOSUB J6 OF 18002380 GOSUB NOT(J6) OF 17002390 GOSUB 29002400 HOME @D:2410 PRINT @D: USING "16X,27A":"CHANNEL 1_________"2420 IF J6=1 THEN 24502430 PRINT @D: USING "12X,8A":"ACQUIRED"2440 GO TO 24602450 PRINT @D: USING "22X,9A":"FROM TAPE"2460 U$=SEG(F$,1,13+(J6=1)*10)2470 GOSUB 36002480 RETURN 2500 REM*** SUBROUTINE TO DRAW & ANALYZE CHANNEL 2 DATA ***2510 DELETE Y,A$2520 Q1=MEMORY2530 DIM Y(B2),A$(LEN(Y$)+5)2540 Y=Y22550 B=B22560 A$=Y$2570 GOSUB J6 OF 18002580 GOSUB NOT(J6) OF 17002590 GOSUB 29002600 HOME @D:2610 PRINT @D: USING "36X,27A":"CHANNEL 2_________"2620 IF J6=1 THEN 26502630 PRINT @D: USING "32X,8A":"ACQUIRED"2640 GO TO 26602650 PRINT @D: USING "42X,9A":"FROM TAPE"2660 U$=SEG(F$,1,33+(J6=1)*10)2670 GOSUB 36002680 RETURN 2700 REM*** SUBROUTINE TO DRAW & ANALYZE CHANNEL ADD DATA ***2710 DELETE Y,A$2720 Q1=MEMORY2730 DIM Y(B3),A$(LEN(Z$)+5)2740 Y=Y32750 B=B32760 A$=Z$2770 GOSUB J6 OF 18002780 GOSUB NOT(J6) OF 17002790 GOSUB 29002800 HOME @D:2810 PRINT @D: USING "56X,36A":"ADD CHANNELS____________"2820 IF J6=1 THEN 28502830 PRINT @D: USING "52X,8A":"ACQUIRED"2840 GO TO 28602850 PRINT @D: USING "62X,9A":"FROM TAPE"2860 U$=SEG(F$,1,53+(J6=1)*10)2870 GOSUB 36002880 RETURN 2900 REM*** SUBROUTINE TO ANALYZE HEADER INFORMATION ***2910 WINDOW 0,130,0,1002920 VIEWPORT 0,130,0,1002930 F$="                                                            "2940 F$=F$&"     "2950 REM*** DETERMINE COUPLING ***2960 P=POS(A$,"WFID:",5)2970 K$=SEG(A$,P+10,3)2980 IF POS(K$,"""",1)=0 THEN 30002990 K$=SEG(K$,1,2)3000 REM*** DETERMINE X-INCREMENT ***3010 P=POS(A$,"XINCR:",30)3020 L$=SEG(A$,P+6,3)3030 IF POS(L$,",",1)=0 THEN 30603040 L$=SEG(L$,1,LEN(L$)-1)3050 GO TO 30303060 REM*** DETERMINE TRIGGER POINT ***3070 P=POS(A$,"PT.OFF:",45)3080 M$=SEG(A$,P+7,3)3090 IF POS(M$,",",1)=0 THEN 31103100 M$=SEG(M$,1,2)3110 REM*** DETERMINE X-UNITS ***3120 P=POS(A$,"XUNIT:",50)3130 N$=SEG(A$,P+6,2)3140 IF POS(N$,",",1)=0 THEN 31603150 N$=SEG(N$,1,1)3160 REM*** DETERMINE Y-MULIPLIER ***3170 P=POS(A$,"YMULT:",60)3180 O$=SEG(A$,P+6,3)3190 IF POS(O$,",",1)=0 THEN 32203200 O$=SEG(O$,1,LEN(O$)-1)3210 GO TO 31903220 REM*** DETERMINE GROUND REFERENCE ***3230 P=POS(A$,"YOFF:",70)3240 P$=SEG(A$,P+5,3)3250 IF POS(P$,",",1)=0 THEN 32803260 P$=SEG(P$,1,LEN(P$)-1)3270 GO TO 32503280 REM*** DETERMINE Y-UNITS ***3290 P=POS(A$,"YUNIT:",75)3300 Q$=SEG(A$,P+6,3)3310 IF POS(Q$,",",1)=0 THEN 33403320 Q$=SEG(Q$,1,LEN(Q$)-1)3330 GO TO 33103340 REM*** TIME/DIVISION ***3350 T1=(50*(B>500)+25*(B<300))*VAL(L$)3360 REM*** VOLTS/DIVISION ***3370 V1=25*VAL(O$)3380 REM*** TRIGGER TIME AFTER START OF SWEEP ***3390 T2=T1/(50*(B>500)+25*(B<300))*VAL(M$)3400 Y5=VAL(P$)3410 Y6=VAL(O$)3420 REM*** FIND MIN & MAX VOLTAGE LEVELS OF DISPLAYED WAVEFORMS ***3430 DIM Y(500*(B>500)+250*(B<300))3440 CALL "MIN",Y,V2,I13450 CALL "MAX",Y,V3,I33460 V2=Y6*(V2-Y5)3470 V3=Y6*(V3-Y5)3480 DIM Y(B)3490 RETURN 3500 REM*** CHANGE TIME REFERENCE ***3510 P=POS(" SMSUSNS",N$,1)3520 R$=SEG("SMSUSNS",P-2,2)3530 RETURN 3550 REM*** CHANGE VOLTAGE REFERENCE ***3560 P=POS(" VMVUVDIV",Q$,1)3570 S$=SEG("VMVUVDIV",P-2,2)3580 RETURN 3600 REM*** PRINT HEADER INFORMATION ***3610 PRINT @D:"J_";U$;K$3620 R$=N$3630 IF T1<1000 THEN 36603640 T1=T1/10003650 GOSUB 35003660 PRINT @D: USING "FA,FD.2D,A,FA":U$;T1;" ";R$3670 S$=Q$3680 IF V1<1000 THEN 37103690 V1=V1/10003700 GOSUB 35503710 IF S$<>"UV" THEN 37303720 S$="UNK"3730 PRINT @D: USING "FA,FD.2D,A,FA":U$;V1;" ";S$3740 R$=N$3750 IF T2<1000 THEN 37803760 T2=T2/10003770 GOSUB 35003780 PRINT @D: USING "FA,FD.2D,A,FA":U$;T2;" ";R$3790 S$=Q$3800 IF ABS(V3)<1000 THEN 38303810 V3=V3/10003820 GOSUB 35503830 IF S$<>"UV" THEN 38503840 S$="UNK"3850 PRINT @D: USING "FA,FD.3D,A,FA":U$;V3;" ";S$3860 S$=Q$3870 IF ABS(V2)<1000 THEN 39003880 V2=V2/10003890 GOSUB 35503900 IF S$<>"UV" THEN 39203910 S$="UNK"3920 PRINT @D: USING "FA,FD.3D,A,FA":U$;V2;" ";S$3930 RETURN 4000 REM*** SUBROUTINE TO ACQUIRE WAVEFORMS FROM TAPE ***4010 PRINT "J_J_"4020 J4=14030 PRINT @37,26:04040 F1=44050 PRINT @33,0:0,0,14060 FIND F14070 INPUT @33:F$4080 PRINT @33,0:0,0,04090 IF POS(F$," LAST ",1)<>0 THEN 41704100 FIND F14110 F$="<EMPTY>"4120 IF TYP(0)<>4 THEN 41404130 READ @33:F$4140 PRINT "	";F1-3;")     ";F$4150 F1=F1+14160 GO TO 40504170 PRINT "J_	ENTER NUMBER OF FILE WAVEFORMS ARE ON: ";4180 INPUT C$4190 C$=C$&"A-4"4200 F2=INT(VAL(C$)+3)4210 IF F2<4 OR F2>F1 THEN 41704220 FIND F24230 READ @33:F$4240 DELETE X$,Y$,Z$,Y1,Y2,Y34250 Q1=MEMORY4260 READ @33:A3,B14270 DIM X$(A3),Y1(B1)4280 READ @33:X$,Y14290 READ @33:A3,B24300 DIM Y$(A3),Y2(B2)4310 READ @33:Y$,Y24320 READ @33:A3,B34330 DIM Z$(A3),Y3(B3)4340 READ @33:Z$,Y34350 J6=14360 PAGE 4370 GOSUB 16004380 RETURN 4400 REM*** SUBROUTINE TO SAVE WAVEFORMS TO TAPE ***4410 PRINT "J_J_"4420 J4=14430 PRINT @37,26:04440 PRINT @33,0:0,0,14450 F1=44460 FIND F14470 INPUT @33:F$4480 IF POS(F$," LAST ",1)<>0 THEN 45304490 F$=SEG(F$,6,40)4500 IF POS(F$," NEW ",1)<>0 AND VAL(F$)=>11000/256 THEN 45604510 F1=F1+14520 GO TO 44604530 PRINT @33,0:0,0,04540 FIND F14550 MARK 1,110004560 PRINT "J_J_ENTER NAME YOU WISH TO STORE WAVEFORM UNDER"4570 INPUT F$4580 IF LEN(F$)=0 THEN 45604590 PRINT @33,0:0,0,04600 F$=SEG(F$,1,40)4610 FIND F14620 WRITE @33:F$4630 IF LEN(X$)>20 THEN 46804640 X$=" "4650 B1=14660 DIM Y1(1)4670 Y1=14680 A3=LEN(X$)+54690 WRITE @33:A3,B1,X$,Y14700 IF LEN(Y$)>20 THEN 47504710 Y$=" "4720 B2=14730 DIM Y2(1)4740 Y2=14750 A3=LEN(Y$)+54760 WRITE @33:A3,B2,Y$,Y24770 IF LEN(Z$)>20 THEN 48204780 Z$=" "4790 B3=14800 DIM Y3(1)4810 Y3=14820 A3=LEN(Z$)+54830 WRITE @33:A3,B3,Z$,Y34840 CLOSE @33:4850 RETURN 4900 REM*** 468 SRQ HANDLER ***4910 POLL A1,A2;J54920 IF A2<>65 THEN 49604930 PRINT "J_J_	POWER ON SRQ COMPLETE"4940 J4=14950 RETURN 4960 IF A2<>195 THEN 49904970 REM*** TRANSMIT SRQ RETURN TO WHAT OPERATION IN PROCESS ***4980 RETURN 4990 IF A2<>196 THEN 50205000 REM*** TALK ONLY MODE TRANSMIT SRQ GO ACQUIRE DATA5010 GOSUB 12005020 RETURN 5100 REM*** SUBROUTINE TO ERASE SCREEN ***5110 J4=15120 PAGE 5130 RETURN 5140 REM*** KEEP SRQ ENABLED ***5150 SET KEY 5160 ON SRQ THEN 49005170 SET KEY 5180 WAIT 5190 GO TO 51405200 REM*** SUBROUTINE TO DETERMINE WHICH WAVEFORM TO ANALYZE ***5210 GOSUB 51005220 PRINT USING "L,26X,FA":"WAVEFORM ANALYSIS"5230 C$=""5240 IF LEN(X$)>5 OR LEN(Y$)>5 OR LEN(Z$)>5 THEN 52705250 GOSUB 85260 GO TO 52805270 CALL "WAIT",0.55280 IF LEN(X$)>5 AND LEN(Y$)<5 AND LEN(Z$)<5 THEN 55005290 IF LEN(Y$)>5 AND LEN(X$)<5 AND LEN(Z$)<5 THEN 56005300 IF LEN(Z$)>5 AND LEN(X$)<5 AND LEN(Y$)<5 THEN 57505310 PRINT "J_WHICH WAVEFORM IS TO BE ANALYZED?"5320 IF LEN(X$)<5 THEN 53505330 PRINT USING "L,10X,FA":"1)  WAVEFORM CHANNEL 1"5340 C$=C$&"1"5350 IF LEN(Y$)<5 THEN 53805360 PRINT USING "L,10X,FA":"2)  WAVEFORM CHANNEL 2"5370 C$=C$&"2"5380 IF LEN(Z$)<5 THEN 54105390 PRINT USING "L,10X,FA":"3)  WAVEFORM ADD CHANNELS"5400 C$=C$&"3"5410 PRINT USING "L,15X,FA,S":"ENTER NUMBER: "5420 INPUT V$5430 IF LEN(V$)=0 OR POS(C$,V$,1)=0 THEN 54105440 V$=V$&"BAD-1"5450 IF VAL(V$)=1 THEN 55005460 IF VAL(V$)=2 THEN 56005470 IF VAL(V$)=3 THEN 57005480 GO TO 54105500 REM*** ANALYZE CHANNEL 1 WAVEFORM DATA ***5510 DELETE Y,A$5520 DIM Y(B1),A$(LEN(X$)+5)5530 Y=Y15540 B=B15550 A$=X$5560 RETURN 5600 REM*** ANALYZE CHANNEL 2 WAVEFORM DATA ***5610 DELETE Y,A$5620 DIM Y(B2),A$(LEN(Y$)+5)5630 Y=Y25640 B=B25650 A$=Y$5660 RETURN 5700 REM*** ANALYZE ADD CHANNELS WAVEFORM DATA ***5710 DELETE Y,A$5720 DIM Y(B3),A$(LEN(Z$)+5)5730 Y=Y35740 B=B35750 A$=Z$5760 RETURN 5800 REM*** SUBROUTINE FOR SIMPLE MIN/MAX PULSE PARAMETERS ***5810 SET NOKEY 5820 J9=295830 GOSUB 51005840 GOSUB 29005850 S$=Q$5860 Y=Y-Y55870 Y=Y*Y65880 IF V1<1000 THEN 59405890 V1=V1/10005900 Y=Y/10005910 GOSUB 35505920 V2=V2/10005930 V3=V3/10005940 IF T1<1000 THEN 59705950 T1=T1/10005960 GOSUB 35005970 VIEWPORT 16,120,50,905980 GOSUB 75005990 PRINT @D,21:34,956000 PRINT @D:"PULSE PARAMETERS FROM MIN AND MAX";6010 GOSUB 61006020 SET KEY 6030 RETURN 6100 REM*** SUBROUTINE TO COMPUTE PULSE PARAMETERS 6110 REM INPUT: array Y, min V2, max V3, J (number of dashes)6120 REM OUTPUT: 10%,50%,90% levels (V4,V5,V6)6130 REM COMPUTE V4,V5 AND V6 ***6140 V4=0.1*(V3-V2)+V26150 V5=0.5*(V3-V2)+V26160 V6=0.9*(V3-V2)+V26170 REM*** COMPUTE VOLTAGE CROSSING POINTS ***6180 CALL "CROSS",Y,V4,T36190 CALL "CROSS",Y,V5,T46200 CALL "CROSS",Y,V6,T56210 CALL "CROSS",Y,V6,T7,26220 CALL "CROSS",Y,V5,T8,26230 CALL "CROSS",Y,V4,T9,26240 CALL "CROSS",Y,V5,T0,36250 REM*** DRAW DOTTED LINES AT VOLTAGE CROSSING POINTS ***6260 MOVE @D:1,V26270 GOSUB 66006280 MOVE @D:1,V36290 GOSUB 66006300 MOVE @D:1,V46310 GOSUB 66006320 MOVE @D:1,V56330 GOSUB 66006340 MOVE @D:1,V66350 GOSUB 66006360 PRINT @D,21:0,406370 PRINT @D: USING "13T,""W A V E F O R M   P A R A M E T E R S"",L":6380 PRINT @D: USING 6680:"  0%",V2,S$6390 PRINT @D: USING 6680:" 10%",V4,S$6400 PRINT @D: USING 6680:" 50%",V5,S$6410 PRINT @D: USING 6680:" 90%",V6,S$6420 PRINT @D: USING 6680:"100%",V3,S$6430 PRINT @D:"";6440 PRINT @D: USING 6660:"RISE TIME",(T5-T3)*S1,R$6450 IF T7<0 THEN 65506460 PRINT @D: USING 6660:"90% WIDTH",(T7-T5)*S1,R$6470 IF T8<0 THEN 65506480 PRINT @D: USING 6660:"50% WIDTH",(T8-T4)*S1,R$6490 IF T9<0 THEN 65506500 PRINT @D: USING 6660:"10% WIDTH",(T9-T3)*S1,R$6510 PRINT @D: USING 6660:"FALL TIME",(T9-T7)*S1,R$6520 IF T0<0 THEN 65506530 PRINT @D: USING 6660:"PERIOD AT 50% WIDTH",(T0-T4)*S1,R$6540 PRI @D: USI 6670:"SYMMETRY AT 50% WIDTH",(T8-T4)/(T0-T4)*100,"%"6550 RETURN 6600 REM*** SUBROUTINE TO DRAW DASH LINES ***6610 FOR I=1 TO J96620 PRINT @D:" _";6630 NEXT I6640 RETURN 6650 REM*** PRINT IMAGES ***6660 IMAGE 32T,23A,3E,X,3A6670 IMAGE 32T,24A,2D.2D,X,A6680 IMAGE 3T,4A," LEVEL:",5D.2D,X,FA6690 IMAGE 10T,12A,6E,"S"6700 IMAGE 4D.2D6710 END 6800 REM*** SUBROUTINE FOR HISTOGRAM PULSE PARAMETERS ***6810 SET NOKEY 6820 GOSUB 51006830 GOSUB 29006840 S$=Q$6850 Y=Y-Y56860 Y=Y*Y66870 IF V1<1000 THEN 69106880 V1=V1/10006890 Y=Y/10006900 GOSUB 35506910 VIEWPORT 16,80,50,906920 GOSUB 75006930 HOME 6940 PRINT @D: USING "19T,""J_PULSE PARAMETERS BY HISTOGRAM METHOD""":6950 REM DIMENSION AND COMPUT HISTOGRAM6960 REM KEEP TWO HALVES TO FACILITATE FINDING BOTH PEAKS6970 DIM V7(B/2),V8(B/2)6980 V7=06990 V8=07000 M3=B/(W2-W1)7010 FOR I9=1 TO 500*(B>500)+250*(B<300)7020 J=INT((Y(I9)-W1)*M3)+17030 IF J>B/2 THEN 70607040 V7(J MAX 1)=V7(J MAX 1)+17050 GO TO 70707060 V8(J-B/2)=V8(J-B/2)+17070 NEXT I97080 VIEWPORT 90,120,50,907090 V7=V7/Y67100 V7=V7+Y57110 V8=V8/Y67120 V8=V8+Y57130 CALL "MAX",V7,M4,M17140 CALL "MAX",V8,M5,M27150 M3=M4 MAX M57160 CALL "MIN",V8,M6,I97170 CALL "MIN",V8,M7,I97180 M6=M6 MIN M77190 WINDOW M6,M3,0,B7200 HOME @D:7210 PRINT @D: USING "54T,""J_J_HISTOGRAM""":7220 AXIS @D:M3/5,64,M6,07230 MOVE @D:V7(1),17240 FOR I9=1 TO B/27250 DRAW @D:V7(I9),I97260 NEXT I97270 DELETE V77280 MOVE @D:V8(1),B/27290 FOR I9=1 TO B/27300 DRAW @D:V8(I9),I9+B/27310 NEXT I97320 DELETE V87330 REM NOW RE-CONVERT M1&M2 (H INDEXES) TO 0% AND 100% LEVELS7340 M3=(B-1)/(W2-W1)7350 V2=(M1-1)/M3+W17360 V3=(M2+256-1)/M3+W17370 REM RESTORE PROPER WINDOW & VIEWPORT7380 WINDOW 1,B,W1,W27390 J9=187400 VIEWPORT 16,80,50,907410 GOSUB 61007420 SET KEY 7430 RETURN 7500 REM*** SUBROUTINE TO GRAPH WAVEFORM TO BE ANALYZED ***7510 IF T1<1000 THEN 75407520 T1=T1/10007530 GOSUB 35007540 S1=T1/B*10.247550 CALL "MIN",Y,W1,W37560 CALL "MAX",Y,W2,W37570 REM ROUND MIN TO 2 DIGITS7580 IF W1=0 THEN 76107590 W3=INT(LGT(ABS(W1)))7600 W1=INT(W1*10^(1-W3))*10^(W3-1)7610 REM COMPUTE MINIMUM POSSIBLE INTERVAL7620 W2=(W2-W1)/87630 IF W2<>0 THEN 76507640 W2=0.1397650 REM ROUND INTERVAL TO NEXT GREATER 2 SIG DIGITS7660 W3=10^(1-INT(LGT(W2)))7670 W2=INT(W2*W3+0.5)+17680 W2=W2/W37690 REM FINALLY, COMPUTE TOP OF GRAPH7700 W2=W1+8*W27710 WINDOW 1,500*(B>500)+250*(B<300),W1,W27720 AXIS @D:(500*(B>500)+250*(B<300))/10,(W2-W1)/8,1,W17730 REM SET W3 AS VERTICAL LABLE SCALING7740 V$=""7750 W3=INT(LGT(ABS(W2)))7760 IF W3=0 THEN 77907770 V$=STR(10^W3)7780 V$=V$&" "7790 V$=V$&S$7800 MOVE @D:1,W27810 PRINT @D:"";V$;7820 REM PRINT VERTICAL LABLES7830 FOR I=0 TO 87840 MOVE @D:1,(W2-W1)/8*I+W17850 PRINT @D: USING """"",4D.2D":((W2-W1)/8*I+W1)/10^W3;7860 NEXT I7870 REM SET W3 TO HORIZONTAL LABLE SCALING7880 W3=INT(LGT(S1*(500*(B>500)+250*(B<300))))7890 V$=""7900 IF W3=0 THEN 79307910 V$=STR(10^W3)7920 V$=V$&" "7930 V$=V$&R$7940 MOVE @D:B/2,W17950 PRINT @D:"J_J_";V$;7960 REM PRINT HORIZONTAL LABLES7970 B4=500*(B>500)+250*(B<300)7980 FOR I=0 TO 107990 MOVE @D:I*(B4-1)/10+1,W18000 PRINT @D: USING """J_"",2D.D,S":I*(B4-1)/10*S1/10^W3;8010 NEXT I8020 DIM X(500*(B>500)+250*(B<300)),Y(500*(B>500)+250*(B<300))8030 MOVE @D:X(1),Y(1)8040 DRAW @D:X,Y8050 DIM X(512)8060 RETURN 8100 REM*** SUBROUTINE TO INTEGRATE WAVEFORM ***8110 SET NOKEY 8120 GOSUB 51008130 GOSUB 29008140 R$=N$8150 S$=Q$8160 Y=Y-Y58170 Y=Y*Y68180 IF V1<1000 THEN 82208190 V1=V1/10008200 Y=Y/10008210 GOSUB 35508220 IF T1<1000 THEN 82508230 T1=T1/10008240 GOSUB 35008250 VIEWPORT 16,120,55,908260 GOSUB 75008270 PRINT @D,21:50,958280 PRINT @D:"ORIGINAL WAVEFORM"8290 VIEWPORT 16,120,10,458300 CALL "INT",Y,Y8310 IF S$<>"MV" THEN 83408320 Y=Y/10008330 S$="V"8340 IF S$<>"UV" THEN 83708350 Y=Y/10000008360 S$="V"8370 IF R$<>"NS" THEN 83908380 Y=Y*(T1/(50*(B>500)+25*(B<300))*1.0E-9)8390 IF R$<>"US" THEN 84108400 Y=Y*(T1/(50*(B>500)+25*(B<300))*1.0E-6)8410 IF R$<>"MS" THEN 84308420 Y=Y*(T1/(50*(B>500)+25*(B<300))*1.0E-3)8430 S$="VS"8440 GOSUB 75008450 PRINT @D,21:50,458460 PRINT @D:"INTEGRATED WAVEFORM"8470 S$=Q$8480 SET KEY 8490 HOME @D:8500 RETURN 8600 REM*** SUBROUTINE TO DIFFERENTIATE WAVEFORM ***8610 SET NOKEY 8620 PRINT "J_J_2-POINT OR 3-POINT DIFFERENTIATION? (ENTER 2 OR 3):";8630 INPUT T$8640 T$=T$&"BAD-1"8650 GOSUB 51008660 IF VAL(T$)<>2 AND VAL(T$)<>3 THEN 86208670 GOSUB 29008680 R$=N$8690 S$=Q$8700 Y=Y-Y58710 Y=Y*Y68720 IF V1<1000 THEN 87608730 V1=V1/10008740 Y=Y/10008750 GOSUB 35508760 IF T1<1000 THEN 87908770 T1=T1/10008780 GOSUB 35008790 VIEWPORT 16,120,55,908800 GOSUB 75008810 PRINT @D,21:53,908820 PRINT @D:"ORIGINAL WAVEFORM"8830 VIEWPORT 16,120,10,458840 IF VAL(T$)<>2 THEN 88708850 CALL "DIF2",Y,Y8860 GO TO 88808870 CALL "DIF3",Y,Y8880 IF S$<>"MV" THEN 89108890 Y=Y/10008900 S$="V"8910 IF S$<>"UV" THEN 89308920 Y=Y/10000008930 S$="V"8940 IF R$<>"NS" THEN 89608950 Y=Y/(T1/(50*(B>500)+25*(B<300))*1.0E-9)8960 IF R$<>"US" THEN 89808970 Y=Y/(T1/(50*(B>500)+25*(B<300))*1.0E-6)8980 IF R$<>"MS" THEN 90008990 Y=Y/(T1/(50*(B>500)+25*(B<300))*1.0E-3)9000 S$="V/S"9010 GOSUB 75009020 PRINT @D,21:40,459030 PRINT @D:"DIFFERENTIATED WAVEFORM ";VAL(T$);" POINT"9040 HOME @D:9050 S$=Q$9060 SET KEY 9070 RETURN 9100 REM*** SUBROUTINE TO APPLY COSINE WINDOW ***9110 SET NOKEY 9120 PRINT "J_APPLY COSINE WINDOW? (Y OR N): ";9130 INPUT T$9140 IF LEN(T$)=0 OR POS("YESNO",T$,1)=0 THEN 91209150 IF POS("NO",T$,1)>0 THEN 93709160 GOSUB 29009170 IF T1<1000 THEN 92009180 T1=T1/10009190 GOSUB 35009200 PRINT "J_ENTER PERCENT OF TAPER (0 TO 50): ";9210 INPUT T$9220 T$=T$&"BAD-1"9230 IF VAL(T$)<0 OR VAL(T$)>50 THEN 92009240 GOSUB 51009250 VIEWPORT 16,120,55,909260 GOSUB 75009270 PRINT @D,21:54,959280 PRINT @D:"ORIGINAL WAVEFORM"9290 CALL "TAPER",Y,VAL(T$)/1009300 VIEWPORT 16,120,10,459310 GOSUB 75009320 PRINT @D,21:40,459330 PRINT @D:"WAVEFORM WITH ";VAL(T$);"% COSINE TAPER"9340 HOME @D:9350 CALL "WAIT",39360 SET KEY 9370 RETURN 9400 REM*** SUBROUTINE FOR FFT OF WAVEFORM ***9410 SET NOKEY 9420 GOSUB 29009430 S$=Q$9440 DIM Y(B)9450 Y=Y-Y59460 Y=Y*Y69470 IF V1<1000 THEN 95109480 V1=V1/10009490 Y=Y/10009500 GOSUB 35509510 GOSUB 91009520 DIM Y(B)9530 CALL "FFT",Y9540 DIM Y7(B/2+1),Y8(B/2+1)9550 CALL "POLAR",Y,Y7,Y89560 GOSUB 51009570 Y7=Y7/(B/2)9580 CALL "MAX",Y7,Z1,H19590 Z1=INT(Z1*100)/1009600 IF Z1<1000 THEN 96409610 Z1=Z1/10009620 Y7=Y7/10009630 GOSUB 35509640 IF T1<1000 THEN 96709650 T1=T1/10009660 GOSUB 35009670 Z3=09680 Z3=1.0E-9*(R$="NS")+1.0E-6*(R$="US")+1.0E-3*(R$="MS")9690 Z3=Z3*(T1/50*(B>500)+T1/25*(B<300))9700 Z3=1/Z3/29710 WINDOW 0,B/2+1,0,Z19720 VIEWPORT 16,120,55,959730 AXIS @D:B/2/10,Z1/5,0,09740 DIM X(B/2+1)9750 MOVE @D:X(1),Y7(1)9760 DRAW @D:X,Y79770 MOVE @D:0,Z19780 PRINT @D:"";S$;9790 FOR I=0 TO Z1 STEP Z1/59800 MOVE @D:0,I9810 PRINT @D: USING "FA,FD.2D":"";INT(I*100)/100;9820 NEXT I9830 FOR I=0 TO 1 STEP 0.19840 MOVE @D:I*(B/2),09850 PRINT @D: USING "FA,FD.2D":"J_";I;9860 NEXT I9870 PRINT @D: USING "30X,FD,X,FA":Z3,"Hz";9880 PRINT @D,21:50,959890 PRINT @D:"FFT MAGNITUDE";9900 WINDOW 0,B/2+1,-PI,PI9910 VIEWPORT 16,120,10,459920 AXIS @D:B/2/10,PI/2,0,-PI9930 MOVE @D:X(1),Y8(1)9940 DRAW @D:X,Y89950 MOVE @D:0,PI9960 PRINT @D:"RADIANS";9970 FOR I=0 TO 1 STEP 0.19980 MOVE @D:I*(B/2),-PI9990 PRINT @D: USING "FA,FD.2D":"J_";I;10000 NEXT I10010 PRINT @D: USING "30X,FD,X,FA":Z3;"Hz";10020 FOR I=-PI TO PI STEP PI/210030 MOVE @D:0,I10040 PRINT @D: USING "FA,FD.3D":"";I10050 NEXT I10060 PRINT @D,21:50,4510070 PRINT @D:"FFT PHASE"10080 DIM X(512)10090 DELETE Y7,Y8,Z110100 Z3=MEMORY10110 HOME @D:10120 SET KEY 10130 RETURN 10200 REM*** SUBROUTINE FOR RMS OF WAVEFORM PERIOD & RMS OF PERIOD ***10210 SET NOKEY 10220 GOSUB 510010230 GOSUB 290010240 R$=N$10250 S$=Q$10260 Y=Y-Y510270 Y=Y*Y610280 IF V1<1000 THEN 1032010290 V1=V1/100010300 Y=Y/100010310 GOSUB 355010320 DIM Y(500*(B>500)+250*(B<300))10330 IF T1<1000 THEN 1036010340 T1=T1/100010350 GOSUB 350010360 VIEWPORT 16,120,55,9010370 GOSUB 750010380 PRINT @D,21:50,9510390 PRINT @D:"ORIGINAL WAVEFORM"10400 PRINT @D,21:0,4010410 PRINT @D: USING "13T,""W A V E F O R M  P A R A M E T E R S"",L":10420 DELETE Y810430 IMAGE 3X,35A,A,3X,FD.4D,X,FA10440 DIM Y8(500*(B>500)+250*(B<300))10450 Y8=Y^210460 PRINT @D: USING 10430:"MEAN OF WAVEFORM (AC+DC)","=",SUM(Y)/B,S$10470 Y9=SUM(Y8)10480 PRINT @D: USING 10430:"RMS OF WAVEFORM (AC+DC)","=",(Y9/B)^0.5,S$10490 CALL "MIN",Y,V2,H110500 CALL "MAX",Y,V3,H110510 PRINT @D: USING 10430:"MAX OF WAVEFORM","=",V3,S$10520 PRINT @D: USING 10430:"MIN OF WAVEFORM","=",V2,S$10530 V5=0.5*(V3-V2)+V210540 CALL "CROSS",Y,V5,T5,110550 CALL "CROSS",Y,V5,T2,210560 CALL "CROSS",Y,V5,T3,310570 DELETE Y7,Y810580 IF T3<0 THEN 1084010590 DIM Y7(INT(T3-T5+1)),Y8(INT(T3-T5+1))10600 I9=110610 FOR I=INT(T5) TO INT(T3)10620 IF I9>INT(T3-T5+1) THEN 1065010630 Y7(I9)=Y(I)10640 I9=I9+110650 NEXT I10660 Y8=Y7^210670 T4=T3-T510680 PRI @D: USI 10430:"MEAN OF ONE CYCLE (AC+DC)","=",SUM(Y7)/T4,S$10690 Y9=SUM(Y8)10700 PRI @D: USI 10430:"RMS OF ONE CYCLE (AC+DC)","=",(Y9/T4)^0.5,S$10710 PRINT @D: USING 10430:"PERIOD OF ONE CYCLE","=",T4*S1,R$10720 T4=(T2-T5)/(T3-T5)*10010730 PRINT @D: USING 10430:"SYMMETRY AT 50% LEVEL","=",T4,"%"10740 MOVE @D:T5,V510750 GOSUB 1090010760 MOVE @D:T2,V510770 GOSUB 1090010780 MOVE @D:T3,V510790 GOSUB 1090010800 HOME @D:10810 DELETE Y7,Y8,Y910820 T4=MEMORY10830 SET KEY 10840 RETURN 10900 REM*** SUBROUTINE TO MARK 50% POINT FOR FK#17 ***10910 INPUT @D,24:T5,T610920 PRINT @D,21:T5-2,T6+210930 PRINT @D,20:T5+2,T6-210940 PRINT @D,21:T5-2,T6-210950 PRINT @D,20:T5+2,T6+210960 RETURN 