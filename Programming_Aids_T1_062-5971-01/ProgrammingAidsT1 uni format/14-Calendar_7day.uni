1 REM 51/00-0902/0 *** Calendar Routines -- 7-Day Week ***2 REM       Author:  Judy Peterman, IDS Mktg, Applications Development100 DIM B2(3),B9(3),C$(9),C0(12),C1(4),C2(3),C3(3),C9(3),F$(51),G$(54)110 DIM R$(24),V$(15),W$(48)120 DATA 31,28,31,30,31,30,31,31,30,31,30,31,1,7,1,3130 RESTORE 120140 READ C0,C1150 F$="   Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec "160 N3=-2.713E+288170 V$=STR(N3)180 W$="        Sun   Mon  TuesWednes Thurs   Fri Satur"190 G$="         days     weeks    months   quarters years   "200 GO TO 40001980 REM DATE + OR - C5 TIME SEGMENTS  T1=time mesh1990 REM C2=(mm,dd,yy)  C5=# of time segments  C6,C7=scratch2000 IF C5=0 THEN 20902010 C6=SGN(C5)2020 GO TO T1 OF 2030,2030,2220,2220,22402030 C2(2)=C2(2)+C1(T1)*C52040 C0(2)=282050 IF 0.25*C2(3)<>INT(0.25*C2(3)) THEN 20702060 C0(2)=292070 IF C2(2)<1 OR C2(2)>C0(C2(1)) THEN 21002080 C0(2)=282090 RETURN 2100 IF C6+1 THEN 21902110 C2(1)=C2(1)+C62120 IF C2(1)=>1 AND C2(1)<=12 THEN 21702130 C2(3)=C2(3)+C62140 C2(1)=C2(1)-12*C62150 IF T1>2 THEN 21202160 GO TO 21802170 IF T1>2 THEN 22602180 IF C6+1 THEN 20402190 C2(2)=C2(2)-C6*C0(C2(1))2200 IF C6+1 THEN 21102210 GO TO 20402220 C2(1)=C2(1)+C1(T1)*C52230 GO TO 21202240 C2(3)=C2(3)+C52250 GO TO 20802260 C2(2)=C2(2) MIN C0(C2(1))2270 GO TO 20802280 REM DAY #, WEEK #, & DAY OF THE WEEK  C2=(mm,dd,yy)2290 REM C4=day #  C8=week #  C7=day of week  B3=scratch2300 C4=0.25*C2(3)=INT(0.25*C2(3)) AND C2(1)>22310 IF C2(1)=1 THEN 23502320 FOR B3=1 TO C2(1)-12330 C4=C4+C0(B3)2340 NEXT B32350 C4=C4+C2(2)+365*C2(3)+INT(0.25*(C2(3)-1))2360 C8=INT(C4/7)+12370 C7=C4-(C8-1)*7+12380 RETURN 2470 REM TIME SEGMENTS BETWEEN DATES  T1=time mesh  2480 REM 1st date=B2=(mm,dd,yy)  C8=# of time segments2490 REM 2nd date=C3=(mm,dd,yy)  B2,B3,C0,C2,C4,C5,C6,C7=scratch2500 GO TO T1 OF 2510,2510,2620,2620,26502510 C2=C32520 GOSUB 23002530 C5=C42540 C6=C82550 C2=B22560 GOSUB 23002570 IF T1=2 THEN 26002580 C8=C5-C42590 RETURN 2600 C8=C6-C82610 RETURN 2620 C8=INT((C3(1)+2)/C1(T1))-INT((B2(1)+2)/C1(T1))2630 C8=12/C1(T1)*(C3(3)-B2(3))+C82640 RETURN 2650 C8=C3(3)-B2(3)2660 RETURN 2680 REM DATE ENTRY VERIFY  E1=flag (118=bad 0=OK)  R$=date string2690 REM C2=(mm,dd,yy)  C7=pos of 1st "/"  C8=pos of 2nd "/"2700 E1=02710 C7=POS(R$,"/",1)2720 C8=POS(R$,"/",C7+1)2730 C2(2)=12740 B$=SEG(R$,(C8 MAX C7)+1,LEN(R$)-(C8 MAX C7))2750 B$=B$&V$2760 C2(3)=VAL(B$)2770 IF C2(3)<>N3 AND C2(3)=>1 AND C2(3)=INT(C2(3)) THEN 28002780 E1=1182790 GO TO 46302800 IF C7<>0 THEN 28402810 IF T1<>5 THEN 27802820 C2(1)=12830 RETURN 2840 B$=SEG(R$,1,C7-1)2850 IF B$<>"END" THEN 29002860 IF T1<>5 AND C8<>0 THEN 27802870 C2(1)=122880 C2(2)=312890 RETURN 2900 B$=B$&V$2910 C2(1)=VAL(B$)2920 IF C2(1)=N3 OR C2(1)>12 OR C2(1)<>INT(C2(1)) OR C2(1)<1 THEN 27802930 IF C8<>0 THEN 29902940 IF T1<3 OR T1=5 THEN 27802950 C2(1)=C1(T1)*(C2(1)-1)+12960 C2(1)=C2(1)+C9(1)-C1(T1)*INT(C9(1)/C1(T1)-0.2)-12970 IF C2(1)>12 THEN 27802980 RETURN 2990 C0(2)=283000 IF 0.25*C2(3)<>INT(0.25*C2(3)) THEN 30203010 C0(2)=293020 B$=SEG(R$,C7+1,C8-C7-1)3030 IF B$<>"END" THEN 30903040 IF T1<3 OR T1>4 THEN 27803050 C2(1)=C1(T1)*C2(1)3060 IF C2(1)>12 THEN 27803070 C2(2)=C0(C2(1))3080 RETURN 3090 B$=B$&V$3100 C2(2)=VAL(B$)3110 IF C2(2)=N3 OR C2(2)<>INT(C2(2)) OR C2(2)<1 THEN 27803120 IF C2(2)>C0(C2(1)) THEN 27803130 C0(2)=283140 RETURN 3190 REM Unpack date  C6=packed date  C9=(mm,dd,yy)3200 C6=1.0E-4*C63210 E1=03220 FOR C4=1 TO 33230 C9(C4)=INT(C6+1.0E-8)3240 C6=100*(C6-C9(C4))3250 NEXT C43260 IF C9(1)<1 OR C9(1)>12 OR C9(2)<1 OR C9(3)<1 THEN 27803270 IF C9(1)<>2 OR 0.25*C9(3)<>INT(0.25*C9(3)) THEN 33003280 IF C9(2)>29 AND C9(2)<>31 THEN 27803290 RETURN 3300 IF C9(2)>C0(C9(1)) AND C9(2)<>31 THEN 27803310 RETURN 3990 REM Run some examples4000 PRINT "	Calendar Routines"4010 PRINT "
Enter time mesh (i.e. 1=daily, 2=weekly, 3=monthly,"4020 PRINT "                      4=quarterly, 5=yearly) ";4030 INPUT T14040 IF T1<1 OR T1>5 THEN 40104050 C$=SEG(G$,9*T1,9)4060 S0=POS(C$," ",LEN(C$))4070 IF S0=0 THEN 41004080 C$=REP("",LEN(C$),1)4090 GO TO 40604100 PRINT "
Enter packed date (i.e. 120577) ";4110 INPUT P$4120 B$=P$&V$4130 C6=VAL(B$)4140 IF C6=N3 THEN 41004150 GOSUB 32004160 IF E1 THEN 41004170 PRINT "Your date unpacked is ";C9(1);"/";C9(2);"/";C9(3)4180 B2=C94190 PRINT "

Permitted format for ""dates"":"4200 PRINT "   mm/dd/yy  (e.g. 11/7/74)"4210 GO TO T1 OF 4300,4300,4220,4250,42804220 PRINT "      mm/yy  (e.g. 6/84     =  6/ 1/84)"4230 PRINT "  mm/END/yy  (e.g. 6/END/84   =  6/30/84)"4240 GO TO 43004250 PRINT "      qq/yy  (e.g. 4/84     = 10/ 1/84)"4260 PRINT "  qq/END/yy  (e.g. 4/END/84   = 12/31/84)"4270 GO TO 43004280 PRINT "         yy  (e.g. 84       =  1/ 1/84)"4290 PRINT "     END/yy  (e.g. END/84   = 12/31/84)"4300 PRINT "
Enter another date ";4310 INPUT R$4320 GOSUB 27004330 IF E1 THEN 43004340 C3=C24350 GOSUB 25004360 B$=SEG(F$,4*B2(1),4)4370 S0=1900+B2(3)4380 PRINT "
1st date is ";B$;B2(2);", ";S04390 B$=SEG(F$,4*C3(1),4)4400 S0=1900+C3(3)4410 PRINT "2nd date is ";B$;C3(2);", ";S04420 PRINT "Time between dates is ";C8;C$4430 PRINT "
Enter a date ";4440 INPUT R$4450 PRINT "Enter # of";C$;" (+ or -) ";4460 INPUT C54470 GOSUB 27004480 IF E1 THEN 44304490 GOSUB 20004500 B$=SEG(F$,4*C2(1),4)4510 S0=1900+C2(3)4520 PRINT "
Date plus ";C5;C$;" is ";B$;C2(2);", ";S04530 PRINT "

Enter date ";4540 INPUT R$4550 GOSUB 27004560 IF E1 THEN 45304570 GOSUB 23004580 B$=SEG(W$,6*C7,6)4590 PRINT "It is a ";B$;"day"4600 PRINT "It is day #";C44610 PRINT "It is in week #";C84620 GO TO 40004630 PRINT "

Invalid Entry. Try again."4640 RETURN 