1 REM 51/00-0903/0 *** Calendar Routines -- 5-Day Week ***2 REM       Author:  Judy Peterman, IDS Mktg, Applications Development100 DIM B2(3),B9(3),C$(9),C0(12),C1(4),C2(3),C3(3),C9(3),F$(51),G$(54)110 DIM R$(24),V$(15),W$(48)120 DATA 31,28,31,30,31,30,31,31,30,31,30,31,1,7,1,3130 RESTORE 120140 READ C0,C1150 F$="   Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec "160 N3=-2.713E+288170 V$=STR(N3)180 W$="        Sun   Mon  TuesWednes Thurs   Fri Satur"190 G$="         days     weeks    months   quarters years   "200 GO TO 40001980 REM DATE + OR - C5 TIME SEGMENTS  T1=time mesh1990 REM C2=(mm,dd,yy)  C5=# of time segments  C6,C7=scratch2000 IF C5=0 THEN 21102010 C6=SGN(C5)2020 GO TO T1 OF 2030,2050,2240,2240,22602030 GOSUB 24002040 C5=C5+2*INT((C5+C7-2)/5)2050 C2(2)=C2(2)+C1(T1)*C52060 C0(2)=282070 IF 0.25*C2(3)<>INT(0.25*C2(3)) THEN 20902080 C0(2)=292090 IF C2(2)<1 OR C2(2)>C0(C2(1)) THEN 21202100 C0(2)=282110 RETURN 2120 IF C6+1 THEN 22102130 C2(1)=C2(1)+C62140 IF C2(1)=>1 AND C2(1)<=12 THEN 21902150 C2(3)=C2(3)+C62160 C2(1)=C2(1)-12*C62170 IF T1>2 THEN 21402180 GO TO 22002190 IF T1>2 THEN 22802200 IF C6+1 THEN 20602210 C2(2)=C2(2)-C6*C0(C2(1))2220 IF C6+1 THEN 21302230 GO TO 20602240 C2(1)=C2(1)+C1(T1)*C52250 GO TO 21402260 C2(3)=C2(3)+C52270 GO TO 21002280 C2(2)=C2(2) MIN C0(C2(1))2290 GO TO 21002380 REM DAY #, WEEK #, & DAY OF THE WEEK  C2=(mm,dd,yy)2390 REM C4=day #  C8=week #  C7=day of week  B3=scratch2400 C4=0.25*C2(3)=INT(0.25*C2(3)) AND C2(1)>22410 IF C2(1)=1 THEN 24502420 FOR B3=1 TO C2(1)-12430 C4=C4+C0(B3)2440 NEXT B32450 C4=C4+C2(2)+365*C2(3)+INT(0.25*(C2(3)-1))2460 C8=INT(C4/7)+12470 C7=C4-(C8-1)*7+12480 RETURN 2570 REM TIME SEGMENTS BETWEEN DATES  T1=time mesh  2580 REM 1st date=B2=(mm,dd,yy)  C8=# of time segments2590 REM 2nd date=C3=(mm,dd,yy)  B2,B3,C0,C2,C4,C5,C6,C7=scratch2600 GO TO T1 OF 2610,2610,2740,2740,27702610 C2=C32620 GOSUB 24002630 C5=C42640 C6=C82650 C2=B22660 GOSUB 24002670 IF T1=2 THEN 27202680 C8=C5-C4-2*INT((C5-C4+C7-2)/7)2690 IF (C5-C4+C7-1)/7<>INT((C5-C4+C7-1)/7) THEN 27102700 C8=C8-12710 RETURN 2720 C8=C6-C82730 RETURN 2740 C8=INT((C3(1)+2)/C1(T1))-INT((B2(1)+2)/C1(T1))2750 C8=12/C1(T1)*(C3(3)-B2(3))+C82760 RETURN 2770 C8=C3(3)-B2(3)2780 RETURN 2880 REM DATE ENTRY VERIFY  E1=flag (118=bad 0=OK)  R$=date string2890 REM C2=(mm,dd,yy)  C7=pos of 1st "/"  C8=pos of 2nd "/"2900 E1=02910 C7=POS(R$,"/",1)2920 C8=POS(R$,"/",C7+1)2930 C2(2)=12940 B$=SEG(R$,(C8 MAX C7)+1,LEN(R$)-(C8 MAX C7))2950 B$=B$&V$2960 C2(3)=VAL(B$)2970 IF C2(3)<>N3 AND C2(3)=>1 AND C2(3)=INT(C2(3)) THEN 30002980 E1=1182990 GO TO 46403000 IF C7<>0 THEN 30403010 IF T1<>5 THEN 29803020 C2(1)=13030 GO TO 33403040 B$=SEG(R$,1,C7-1)3050 IF B$<>"END" THEN 31003060 IF T1<>5 AND C8<>0 THEN 29803070 C2(1)=123080 C2(2)=313090 GO TO 33403100 B$=B$&V$3110 C2(1)=VAL(B$)3120 IF C2(1)=N3 OR C2(1)>12 OR C2(1)<>INT(C2(1)) OR C2(1)<1 THEN 29803130 IF C8<>0 THEN 31903140 IF T1<3 OR T1=5 THEN 29803150 C2(1)=C1(T1)*(C2(1)-1)+13160 C2(1)=C2(1)+C9(1)-C1(T1)*INT(C9(1)/C1(T1)-0.2)-13170 IF C2(1)>12 THEN 29803180 GO TO 33403190 C0(2)=283200 IF 0.25*C2(3)<>INT(0.25*C2(3)) THEN 32203210 C0(2)=293220 B$=SEG(R$,C7+1,C8-C7-1)3230 IF B$<>"END" THEN 32903240 IF T1<3 OR T1>4 THEN 29803250 C2(1)=C1(T1)*C2(1)3260 IF C2(1)>12 THEN 29803270 C2(2)=C0(C2(1))3280 GO TO 33403290 B$=B$&V$3300 C2(2)=VAL(B$)3310 IF C2(2)=N3 OR C2(2)<>INT(C2(2)) OR C2(2)<1 THEN 29803320 IF C2(2)>C0(C2(1)) THEN 29803330 C0(2)=283340 IF T1>1 THEN 33903350 GOSUB 24003360 IF C7<>1 AND C7<>7 THEN 33903370 E1=1203380 GO TO 46403390 RETURN 3490 REM Unpack date  C6=packed date  C9=(mm,dd,yy)3500 C6=1.0E-4*C63510 E1=03520 FOR C4=1 TO 33530 C9(C4)=INT(C6+1.0E-8)3540 C6=100*(C6-C9(C4))3550 NEXT C43560 IF C9(1)<1 OR C9(1)>12 OR C9(2)<1 OR C9(3)<1 THEN 33703570 IF C9(1)<>2 OR 0.25*C9(3)<>INT(0.25*C9(3)) THEN 36003580 IF C9(2)>29 AND C9(2)<>31 THEN 33703590 RETURN 3600 IF C9(2)>C0(C9(1)) AND C9(2)<>31 THEN 33703610 RETURN 3990 REM Run some examples4000 PRINT "	Calendar Routines"4010 PRINT "
Enter time mesh (i.e. 1=daily, 2=weekly, 3=monthly,"4020 PRINT "                      4=quarterly, 5=yearly) ";4030 INPUT T14040 IF T1<1 OR T1>5 THEN 40104050 C$=SEG(G$,9*T1,9)4060 S0=POS(C$," ",LEN(C$))4070 IF S0=0 THEN 41004080 C$=REP("",LEN(C$),1)4090 GO TO 40604100 PRINT "
Enter packed date (i.e. 120577) (not Sat or Sun) ";4110 INPUT P$4120 B$=P$&V$4130 C6=VAL(B$)4140 IF C6=N3 THEN 41004150 GOSUB 35004160 IF E1 THEN 41004170 PRINT "Your date unpacked is ";C9(1);"/";C9(2);"/";C9(3)4180 B2=C94190 PRINT "

Permitted format for ""dates"":"4200 PRINT "   mm/dd/yy  (e.g. 11/7/74)"4210 GO TO T1 OF 4300,4300,4220,4250,42804220 PRINT "      mm/yy  (e.g. 6/84     =  6/ 1/84)"4230 PRINT "  mm/END/yy  (e.g. 6/END/84   =  6/30/84)"4240 GO TO 42104250 PRINT "      qq/yy  (e.g. 4/84     = 10/ 1/84)"4260 PRINT "  qq/END/yy  (e.g. 4/END/84   = 12/31/84)"4270 GO TO 42104280 PRINT "         yy  (e.g. 84       =  1/ 1/84)"4290 PRINT "     END/yy  (e.g. END/84   = 12/31/84)"4300 PRINT "
Enter another date (not Sat or Sun) ";4310 INPUT R$4320 GOSUB 29004330 IF E1 THEN 43004340 C3=C24350 GOSUB 26004360 B$=SEG(F$,4*B2(1),4)4370 S0=1900+B2(3)4380 PRINT "
1st date is ";B$;B2(2);", ";S04390 B$=SEG(F$,4*C3(1),4)4400 S0=1900+C3(3)4410 PRINT "2nd date is ";B$;C3(2);", ";S04420 PRINT "Time (excluding Sat & Sun) between dates is ";C8;C$4430 PRINT "
Enter a date (not Sat or Sun) ";4440 INPUT R$4450 PRINT "Enter # of";C$;" (+ or -) ";4460 INPUT C54470 Y=C54480 GOSUB 29004490 IF E1 THEN 44304500 GOSUB 20004510 B$=SEG(F$,4*C2(1),4)4520 S0=1900+C2(3)4530 PRINT "
Date plus ";Y;C$;" (w/o Sat & Sun) is ";B$;C2(2);", ";S04540 PRINT "

Enter date ";4550 INPUT R$4560 GOSUB 29004570 IF E1 THEN 45404580 GOSUB 24004590 B$=SEG(W$,6*C7,6)4600 PRINT "It is a ";B$;"day"4610 PRINT "It is day #";C44620 PRINT "It is in week #";C84630 GO TO 40004640 PRINT "

Invalid Entry. Did you enter a weekend? Try again."4650 RETURN 